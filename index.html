<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aria &amp; Friends Project Vault</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-base: #050311;
            --bg-alt: #120a2d;
            --text-primary: #f5f3ff;
            --text-muted: #bcb4da;
            --accent-pink: #f7a7da;
            --accent-blue: #93c6ff;
            --accent-lavender: #c2b7ff;
            --card-gradient: linear-gradient(155deg, rgba(23, 16, 52, 0.92), rgba(10, 6, 27, 0.88));
            --border-gradient: linear-gradient(140deg, rgba(244, 170, 219, 0.8), rgba(147, 198, 255, 0.8));
            --radius-lg: 28px;
            --radius-sm: 14px;
            --shadow-strong: 0 35px 65px rgba(8, 4, 22, 0.7);
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            font-family: "Plus Jakarta Sans", "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
            background:
                radial-gradient(circle at top left, rgba(147, 198, 255, 0.28), transparent 55%),
                radial-gradient(circle at bottom right, rgba(247, 167, 218, 0.32), transparent 60%),
                var(--bg-base);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            padding: clamp(1.6rem, 4vw, 3.5rem);
        }

        .back-nav {
            position: fixed;
            top: clamp(0.9rem, 2vw, 1.6rem);
            right: clamp(0.9rem, 2vw, 1.6rem);
            z-index: 40;
        }

        .back-nav__button {
            appearance: none;
            border: 1px solid rgba(147, 198, 255, 0.35);
            background: linear-gradient(135deg, rgba(31, 21, 58, 0.82), rgba(11, 7, 27, 0.88));
            color: var(--text-primary);
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.55rem 1.2rem;
            font-weight: 600;
            letter-spacing: 0.02em;
            cursor: pointer;
            box-shadow: 0 18px 35px rgba(5, 3, 17, 0.35);
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
        }

        .back-nav__button:hover,
        .back-nav__button:focus-visible {
            transform: translateY(-1px);
            border-color: rgba(247, 167, 218, 0.65);
            box-shadow: 0 25px 45px rgba(5, 3, 17, 0.45);
            outline: none;
        }

        .back-nav__icon {
            font-size: 1.1rem;
            line-height: 1;
        }

        .page {
            width: min(1100px, 100%);
            display: grid;
            gap: clamp(2.2rem, 4vw, 3.4rem);
        }

        .page-header {
            display: grid;
            gap: 1.2rem;
            background: linear-gradient(150deg, rgba(21, 13, 40, 0.85), rgba(7, 5, 20, 0.92));
            border-radius: var(--radius-lg);
            padding: clamp(2rem, 4vw, 3rem);
            border: 1px solid rgba(147, 198, 255, 0.18);
            position: relative;
            overflow: hidden;
        }

        .header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .account-area {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .account-button {
            appearance: none;
            border: none;
            background: rgba(147, 198, 255, 0.12);
            color: var(--accent-blue);
            border-radius: 999px;
            padding: 0.45rem 1.1rem;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.02em;
            cursor: pointer;
            transition: background 0.25s ease, transform 0.25s ease;
        }

        .account-button:hover,
        .account-button:focus-visible {
            background: rgba(147, 198, 255, 0.24);
            transform: translateY(-1px);
            outline: none;
        }

        .account-button.is-active {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-pink));
            color: #140827;
        }

        .account-menu {
            position: absolute;
            top: calc(100% + 0.6rem);
            right: 0;
            background: rgba(13, 8, 32, 0.95);
            border: 1px solid rgba(147, 198, 255, 0.18);
            border-radius: var(--radius-sm);
            padding: 0.95rem;
            display: grid;
            gap: 0.95rem;
            width: min(240px, 70vw);
            box-shadow: 0 25px 60px rgba(5, 3, 17, 0.65);
            z-index: 20;
        }

        .account-greeting {
            margin: 0;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .account-greeting strong {
            color: var(--accent-lavender);
        }

        .account-action {
            appearance: none;
            border: none;
            border-radius: var(--radius-sm);
            padding: 0.6rem 1rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-pink));
            color: #140827;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .account-action:hover,
        .account-action:focus-visible {
            transform: translateY(-1px);
            box-shadow: 0 20px 35px rgba(247, 167, 218, 0.28);
            outline: none;
        }

        .avatar-editor {
            border-radius: var(--radius-sm);
            background: rgba(19, 12, 42, 0.72);
            border: 1px solid rgba(147, 198, 255, 0.14);
            padding: 0.75rem;
            display: grid;
            gap: 0.75rem;
        }

        .avatar-heading {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
        }

        .avatar-preview {
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top, rgba(147, 198, 255, 0.18), transparent 65%);
            border-radius: var(--radius-sm);
            padding: 0.5rem;
        }

        .rat-avatar {
            width: 110px;
            height: 110px;
        }

        .rat-avatar svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .rat-avatar [data-layer="outfit"] {
            display: none;
        }

        .rat-avatar[data-outfit="classic"] .outfit-classic,
        .rat-avatar[data-outfit="hoodie"] .outfit-hoodie,
        .rat-avatar[data-outfit="adventurer"] .outfit-adventurer {
            display: inline;
        }

        .avatar-options {
            display: grid;
            gap: 0.4rem;
            margin: 0;
            border: none;
            padding: 0;
        }

        .avatar-options legend {
            font-size: 0.75rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 0.3rem;
        }

        .avatar-option {
            display: grid;
            grid-template-columns: auto 1fr;
            align-items: center;
            gap: 0.45rem;
            font-size: 0.85rem;
            color: var(--text-primary);
            background: rgba(9, 6, 22, 0.55);
            border: 1px solid transparent;
            border-radius: calc(var(--radius-sm) - 4px);
            padding: 0.35rem 0.55rem;
            cursor: pointer;
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        .avatar-option input {
            accent-color: var(--accent-blue);
        }

        .avatar-option:hover,
        .avatar-option:focus-within {
            border-color: rgba(147, 198, 255, 0.4);
            background: rgba(9, 6, 22, 0.75);
        }

        .page-header::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(247, 167, 218, 0.25), transparent 55%);
            pointer-events: none;
            mix-blend-mode: screen;
        }

        .eyebrow {
            letter-spacing: 0.3em;
            text-transform: uppercase;
            font-size: 0.78rem;
            color: var(--accent-blue);
        }

        h1 {
            font-size: clamp(2.4rem, 6vw, 3.6rem);
            line-height: 1.05;
            margin: 0;
        }

        .lede {
            font-size: clamp(1rem, 2.2vw, 1.2rem);
            color: var(--text-muted);
            max-width: 52ch;
        }

        .header-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .meta-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.9rem;
            border-radius: 999px;
            font-size: 0.85rem;
            background: rgba(147, 198, 255, 0.12);
            color: var(--accent-blue);
        }

        .projects {
            display: grid;
            gap: clamp(1.5rem, 3vw, 2.4rem);
        }

        .section-heading {
            display: grid;
            gap: 0.75rem;
        }

        h2 {
            margin: 0;
            font-size: clamp(1.6rem, 3.6vw, 2.4rem);
        }

        .section-heading p {
            margin: 0;
            color: var(--text-muted);
            max-width: 60ch;
        }

        .project-grid {
            display: grid;
            gap: clamp(1.3rem, 2.6vw, 1.9rem);
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        }

        .project-card {
            position: relative;
            display: grid;
            gap: 1.1rem;
            padding: clamp(1.6rem, 3vw, 2.2rem);
            border-radius: var(--radius-lg);
            background: var(--card-gradient);
            border: 1px solid transparent;
            background-clip: padding-box, border-box;
            background-origin: border-box;
            background-image: var(--card-gradient), var(--border-gradient);
            box-shadow: var(--shadow-strong);
            transition: transform 0.35s ease, box-shadow 0.35s ease, border-color 0.35s ease;
        }

        .project-card::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: linear-gradient(160deg, rgba(147, 198, 255, 0.18), rgba(247, 167, 218, 0.08));
            opacity: 0;
            transition: opacity 0.35s ease;
            pointer-events: none;
        }

        .project-card:hover,
        .project-card:focus-within {
            transform: translateY(-6px);
            box-shadow: 0 40px 80px rgba(5, 3, 17, 0.85);
        }

        .project-card:hover::after,
        .project-card:focus-within::after {
            opacity: 1;
        }

        .card-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .status {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            padding: 0.35rem 0.85rem;
            border-radius: 999px;
            font-size: 0.75rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            font-weight: 600;
            background: linear-gradient(120deg, var(--accent-blue), var(--accent-pink));
            color: #140827;
        }

        .tag {
            padding: 0.35rem 0.7rem;
            border-radius: 999px;
            font-size: 0.8rem;
            color: var(--accent-lavender);
            background: rgba(194, 183, 255, 0.16);
        }

        .project-card h3 {
            margin: 0;
            font-size: 1.45rem;
        }

        .project-card p {
            margin: 0;
            color: var(--text-muted);
            font-size: 0.98rem;
            line-height: 1.55;
        }

        .project-meta {
            display: grid;
            gap: 0.35rem;
            font-size: 0.82rem;
            color: rgba(188, 180, 218, 0.85);
        }

        .project-meta span {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .project-meta time {
            color: var(--accent-blue);
        }

        .cta,
        .cta.disabled {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.45rem;
            margin-top: 0.4rem;
            padding: 0.75rem 1.2rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 0.95rem;
            text-decoration: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .cta {
            color: #110720;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-pink));
            box-shadow: 0 18px 32px rgba(147, 198, 255, 0.28);
        }

        .cta:hover,
        .cta:focus-visible {
            transform: translateY(-3px);
            box-shadow: 0 22px 40px rgba(247, 167, 218, 0.32);
        }

        .cta.disabled {
            color: var(--text-muted);
            background: rgba(147, 198, 255, 0.12);
            border: 1px solid rgba(147, 198, 255, 0.22);
            cursor: default;
            box-shadow: none;
            pointer-events: none;
        }

        footer {
            text-align: center;
            color: rgba(188, 180, 218, 0.72);
            font-size: 0.85rem;
            padding-bottom: 0.5rem;
        }

        .auth-backdrop {
            position: fixed;
            inset: 0;
            display: none;
            place-items: center;
            background: rgba(5, 3, 17, 0.76);
            backdrop-filter: blur(18px);
            z-index: 40;
            padding: 1.5rem;
        }

        .auth-backdrop.is-visible {
            display: grid;
        }

        .auth-dialog {
            width: min(420px, 100%);
            background: linear-gradient(160deg, rgba(21, 13, 40, 0.95), rgba(9, 6, 24, 0.92));
            border: 1px solid rgba(147, 198, 255, 0.25);
            border-radius: var(--radius-lg);
            box-shadow: 0 35px 70px rgba(5, 3, 17, 0.8);
            padding: 2.2rem;
            display: grid;
            gap: 1.4rem;
        }

        .auth-dialog h2 {
            font-size: 1.6rem;
            margin: 0;
        }

        .auth-dialog p {
            margin: 0;
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .auth-form {
            display: grid;
            gap: 1rem;
        }

        .auth-field {
            display: grid;
            gap: 0.45rem;
        }

        .auth-field label {
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: var(--accent-blue);
        }

        .auth-field input {
            width: 100%;
            padding: 0.75rem 0.9rem;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(147, 198, 255, 0.24);
            background: rgba(12, 7, 28, 0.65);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: border 0.2s ease, box-shadow 0.2s ease;
        }

        .auth-field input:focus {
            outline: none;
            border-color: rgba(247, 167, 218, 0.7);
            box-shadow: 0 0 0 3px rgba(247, 167, 218, 0.2);
        }

        .auth-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .auth-button {
            appearance: none;
            border: none;
            border-radius: var(--radius-sm);
            padding: 0.7rem 1.3rem;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .auth-button.secondary {
            background: rgba(147, 198, 255, 0.12);
            color: var(--accent-blue);
        }

        .auth-button.primary {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-pink));
            color: #140827;
            box-shadow: 0 18px 32px rgba(147, 198, 255, 0.28);
        }

        .auth-button:hover,
        .auth-button:focus-visible {
            transform: translateY(-1px);
            outline: none;
        }

        .auth-button.primary:hover,
        .auth-button.primary:focus-visible {
            box-shadow: 0 22px 40px rgba(247, 167, 218, 0.32);
        }

        @media (max-width: 720px) {
            body {
                padding: clamp(1.2rem, 6vw, 2rem);
            }

            .header-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.4rem;
            }

            .account-area {
                width: 100%;
            }

            .account-button {
                width: 100%;
                justify-content: center;
            }

            .account-menu {
                position: static;
                width: 100%;
            }

            .card-top {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="back-nav" role="navigation" aria-label="Page navigation">
        <button type="button" class="back-nav__button" data-home="index.html" onclick="handleBack(event)">
            <span class="back-nav__icon" aria-hidden="true">&#8592;</span>
            <span class="back-nav__text">Back</span>
        </button>
    </div>
    <main class="page">
        <header class="page-header">
            <div class="header-bar">
                <span class="eyebrow">Aria &amp; Friends</span>
                <div class="account-area">
                    <button class="account-button" type="button" aria-haspopup="true" aria-expanded="false">
                        Sign in
                    </button>
                    <div class="account-menu" role="menu" hidden>
                        <p class="account-greeting">Signed in as <strong class="account-name">Guest</strong></p>
                        <div class="avatar-editor" data-avatar-editor hidden>
                            <div class="avatar-heading">
                                <span>Avatar</span>
                                <span>Rat style</span>
                            </div>
                            <div class="avatar-preview">
                                <div class="rat-avatar" data-outfit="classic">
                                    <svg viewBox="0 0 140 140" role="img" aria-label="Rat avatar illustration">
                                        <defs>
                                            <linearGradient id="rat-fur" x1="0%" x2="100%" y1="0%" y2="100%">
                                                <stop offset="0%" stop-color="#c7c3d9"></stop>
                                                <stop offset="100%" stop-color="#9c97b2"></stop>
                                            </linearGradient>
                                            <linearGradient id="rat-ear" x1="0%" x2="100%" y1="0%" y2="100%">
                                                <stop offset="0%" stop-color="#f7b4d2"></stop>
                                                <stop offset="100%" stop-color="#f48cbf"></stop>
                                            </linearGradient>
                                        </defs>
                                        <g fill="none" fill-rule="evenodd">
                                            <g transform="translate(20 15)">
                                                <ellipse cx="50" cy="82" rx="42" ry="28" fill="url(#rat-fur)"></ellipse>
                                                <circle cx="50" cy="45" r="34" fill="url(#rat-fur)"></circle>
                                                <path d="M93 82c12 6 16 14 12 20s-14 4-26-2" stroke="#f2aac9" stroke-width="6" stroke-linecap="round"></path>
                                                <ellipse cx="26" cy="16" rx="14" ry="18" fill="url(#rat-ear)" transform="rotate(-20 26 16)"></ellipse>
                                                <ellipse cx="74" cy="16" rx="14" ry="18" fill="url(#rat-ear)" transform="rotate(20 74 16)"></ellipse>
                                                <circle cx="38" cy="46" r="6" fill="#2f1d3e"></circle>
                                                <circle cx="62" cy="46" r="6" fill="#2f1d3e"></circle>
                                                <path d="M50 60c4 0 8 3 8 6s-4 4-8 4-8-1-8-4 4-6 8-6z" fill="#f5d3de"></path>
                                            </g>
                                            <g data-layer="outfit" class="outfit-classic">
                                                <path d="M40 106c6-18 20-26 30-26s24 8 30 26H40z" fill="#7f9cff" stroke="#c7d6ff" stroke-width="3" stroke-linejoin="round"></path>
                                                <circle cx="70" cy="98" r="4" fill="#f5f3ff"></circle>
                                            </g>
                                            <g data-layer="outfit" class="outfit-hoodie">
                                                <path d="M32 108c4-22 18-34 38-34s34 12 38 34H32z" fill="#6d55b9" stroke="#9e84ff" stroke-width="3" stroke-linejoin="round"></path>
                                                <path d="M44 66c8-10 16-12 26-12s18 2 26 12c4 6 6 16 4 20-2 4-12 10-30 10s-28-6-30-10c-2-4 0-14 4-20z" fill="#7563d1" opacity="0.85"></path>
                                            </g>
                                            <g data-layer="outfit" class="outfit-adventurer">
                                                <path d="M36 110l8-26h52l8 26H36z" fill="#f0a95d" stroke="#ffcf90" stroke-width="3" stroke-linejoin="round"></path>
                                                <path d="M50 84l6-16h28l6 16z" fill="#d98946"></path>
                                                <path d="M48 86h44l-4 12H52z" fill="#b86f32"></path>
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                            <fieldset class="avatar-options">
                                <legend>Outfit</legend>
                                <label class="avatar-option">
                                    <input type="radio" name="avatar-outfit" value="classic" checked>
                                    Cozy Classic
                                </label>
                                <label class="avatar-option">
                                    <input type="radio" name="avatar-outfit" value="hoodie">
                                    Midnight Hoodie
                                </label>
                                <label class="avatar-option">
                                    <input type="radio" name="avatar-outfit" value="adventurer">
                                    Adventurer Cape
                                </label>
                            </fieldset>
                        </div>
                        <button class="account-action" type="button" data-action="sign-out">Sign out</button>
                    </div>
                </div>
            </div>
        </header>

        <section class="projects">
            <div class="project-grid">
                <article class="project-card" data-status="live">
                    <div class="card-top">
                        <span class="status">Live</span>
                        <span class="tag">Game</span>
                    </div>
                    <h3>Blackjack Lounge</h3>
                    <a class="cta" href="blackjack.html">Launch table</a>
                </article>

                <article class="project-card" data-status="brewing">
                    <div class="card-top">
                        <span class="status">Brewing</span>
                        <span class="tag">Rhythm</span>
                    </div>
                    <h3>Rhythm Reactor</h3>
                    <span class="cta disabled">Stay tuned</span>
                </article>

                <article class="project-card" data-status="live">
                    <div class="card-top">
                        <span class="status">Live</span>
                        <span class="tag">Game</span>
                    </div>
                    <h3>Rat Race</h3>
                    <a class="cta" href="RatRace.html">Enter race</a>
                </article>

                <article class="project-card" data-status="reserved">
                    <div class="card-top">
                        <span class="status">Reserved</span>
                        <span class="tag">Wildcard</span>
                    </div>
                    <h3>Mystery Slot</h3>
                    <span class="cta disabled">Accepting ideas</span>
                </article>
            </div>
        </section>

        <footer>
            Crafted with stardust gradients and a dash of Sylveon charm. Ping Aria for collab ideas.
        </footer>
    </main>

    <div class="auth-backdrop" role="dialog" aria-modal="true" aria-labelledby="auth-title">
        <div class="auth-dialog">
            <div>
                <h2 id="auth-title">Welcome back</h2>
                <p>Sign in to sync your favorite projects and keep tabs on new drops.</p>
            </div>
            <form class="auth-form" id="auth-form">
                <div class="auth-field">
                    <label for="display-name">Display name</label>
                    <input id="display-name" name="displayName" type="text" autocomplete="name" required placeholder="Sylveon Fan" maxlength="32">
                </div>
                <div class="auth-field">
                    <label for="email">Email</label>
                    <input id="email" name="email" type="email" autocomplete="email" required placeholder="you@example.com">
                </div>
                <div class="auth-actions">
                    <button class="auth-button secondary" type="button" data-action="cancel">Cancel</button>
                    <button class="auth-button primary" type="submit">Sign in</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function handleBack(event) {
            if (event) {
                event.preventDefault();
            }

            const home = event?.currentTarget?.dataset?.home || "index.html";

            const normalizePath = (value) => {
                const url = new URL(value, window.location.origin);
                let path = url.pathname;

                if (path.endsWith("/index.html")) {
                    path = path.slice(0, -"/index.html".length) || "/";
                }

                if (path.endsWith("/")) {
                    path = path.slice(0, -1) || "/";
                }

                return path || "/";
            };

            const currentPath = normalizePath(window.location.pathname || window.location.href);
            const homePath = normalizePath(home);

            if (currentPath === homePath) {
                return;
            }

            window.location.href = home;
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAnalytics, isSupported } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDRniZatGeylxphjHQadYjucOcirNBRIdk",
            authDomain: "multiplayer-640ec.firebaseapp.com",
            databaseURL: "https://multiplayer-640ec-default-rtdb.firebaseio.com",
            projectId: "multiplayer-640ec",
            storageBucket: "multiplayer-640ec.firebasestorage.app",
            messagingSenderId: "94914236381",
            appId: "1:94914236381:web:55ab00cc690140180cf034",
            measurementId: "G-V43J1S8RGF"
        };

        const app = initializeApp(firebaseConfig);
        isSupported()
            .then((supported) => {
                if (supported) {
                    getAnalytics(app);
                }
            })
            .catch((err) => console.warn("Firebase analytics not supported", err));

        const accountKey = "ak-project-vault-account";
        const accountButton = document.querySelector(".account-button");
        const accountMenu = document.querySelector(".account-menu");
        const accountName = document.querySelector(".account-name");
        const accountArea = document.querySelector(".account-area");
        const authBackdrop = document.querySelector(".auth-backdrop");
        const authForm = document.querySelector("#auth-form");

        if (
            accountButton &&
            accountMenu &&
            accountName &&
            accountArea &&
            authBackdrop &&
            authForm
        ) {
            const cancelAuthButton = authForm.querySelector('[data-action="cancel"]');
            const signOutButton = accountMenu.querySelector('[data-action="sign-out"]');
            const nameInput = authForm.querySelector('#display-name');
            const emailInput = authForm.querySelector('#email');
            const avatarEditor = accountMenu.querySelector('[data-avatar-editor]');
            const avatarPreview = avatarEditor?.querySelector('.rat-avatar') ?? null;
            const outfitInputs = avatarEditor
                ? Array.from(avatarEditor.querySelectorAll('input[name="avatar-outfit"]'))
                : [];

            let menuOpen = false;
            let activeAccount = null;
            let storageAvailable = true;

            const defaultAvatar = { outfit: "classic" };

            const normalizeAccount = (account) => {
                if (!account) return null;
                const normalized = { ...account };
                normalized.avatar = {
                    ...defaultAvatar,
                    ...(account.avatar || {}),
                };
                return normalized;
            };

            const getActiveAvatar = () => {
                if (!activeAccount) {
                    return { ...defaultAvatar };
                }
                return {
                    ...defaultAvatar,
                    ...(activeAccount.avatar || {}),
                };
            };

            const updateAvatarUI = () => {
                if (!avatarPreview || !avatarEditor) return;
                if (!activeAccount) {
                    avatarPreview.dataset.outfit = defaultAvatar.outfit;
                    avatarEditor.hidden = true;
                    outfitInputs.forEach((input) => {
                        input.checked = input.value === defaultAvatar.outfit;
                    });
                    return;
                }

                const avatar = getActiveAvatar();
                avatarEditor.hidden = false;
                avatarPreview.dataset.outfit = avatar.outfit;
                outfitInputs.forEach((input) => {
                    input.checked = input.value === avatar.outfit;
                });
            };

            let storedAccount = null;
            try {
                storedAccount = window.localStorage.getItem(accountKey);
            } catch (error) {
                storageAvailable = false;
                console.warn("Account storage unavailable", error);
            }

            if (storedAccount) {
                try {
                    activeAccount = normalizeAccount(JSON.parse(storedAccount));
                } catch (error) {
                    console.warn("Unable to parse stored account", error);
                    if (storageAvailable) {
                        window.localStorage.removeItem(accountKey);
                    }
                }
            }

            const persistAccount = (account) => {
                if (!storageAvailable) return;
                try {
                    if (account) {
                        const normalized = normalizeAccount(account);
                        if (normalized) {
                            activeAccount = normalized;
                        }
                        window.localStorage.setItem(accountKey, JSON.stringify(normalized));
                    } else {
                        window.localStorage.removeItem(accountKey);
                    }
                } catch (error) {
                    storageAvailable = false;
                    console.warn("Unable to persist account", error);
                }
            };

            const closeMenu = () => {
                if (!menuOpen) return;
                accountMenu.hidden = true;
                accountButton.setAttribute("aria-expanded", "false");
                accountButton.classList.remove("is-active");
                menuOpen = false;
            };

            const openMenu = () => {
                accountMenu.hidden = false;
                accountButton.setAttribute("aria-expanded", "true");
                accountButton.classList.add("is-active");
                menuOpen = true;
            };

            const openAuthModal = () => {
                authBackdrop.classList.add("is-visible");
                closeMenu();
                if (activeAccount && nameInput && emailInput) {
                    nameInput.value = activeAccount.name;
                    emailInput.value = activeAccount.email;
                }
                if (nameInput) {
                    requestAnimationFrame(() => {
                        nameInput.focus();
                    });
                }
            };

            const closeAuthModal = () => {
                authBackdrop.classList.remove("is-visible");
                authForm.reset();
                accountButton.focus();
            };

            const getGreetingName = (name) => {
                if (!name) return "Friend";
                const trimmed = name.trim();
                if (!trimmed.includes(" ")) {
                    return trimmed;
                }
                return trimmed.split(" ")[0];
            };

            const updateAccountUI = () => {
                if (activeAccount) {
                    const greetingName = getGreetingName(activeAccount.name);
                    accountName.textContent = activeAccount.name;
                    accountButton.textContent = `Hi, ${greetingName}`;
                    accountButton.dataset.state = "signed-in";
                    accountButton.setAttribute("aria-expanded", menuOpen ? "true" : "false");
                    updateAvatarUI();
                } else {
                    accountName.textContent = "Guest";
                    accountButton.textContent = "Sign in";
                    accountButton.dataset.state = "signed-out";
                    accountButton.classList.remove("is-active");
                    accountButton.setAttribute("aria-expanded", "false");
                    accountMenu.hidden = true;
                    menuOpen = false;
                    updateAvatarUI();
                }
            };

            updateAccountUI();

            outfitInputs.forEach((input) => {
                input.addEventListener("change", (event) => {
                    if (!activeAccount) return;
                    const target = event.target;
                    if (!(target instanceof HTMLInputElement) || !target.checked) return;
                    const outfit = target.value;
                    activeAccount = normalizeAccount({
                        ...activeAccount,
                        avatar: {
                            ...getActiveAvatar(),
                            outfit,
                        },
                    });
                    persistAccount(activeAccount);
                    updateAvatarUI();
                });
            });

            accountButton.addEventListener("click", () => {
                if (accountButton.dataset.state === "signed-in") {
                    if (menuOpen) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                } else {
                    openAuthModal();
                }
            });

            document.addEventListener("click", (event) => {
                if (!menuOpen) return;
                if (!accountArea.contains(event.target)) {
                    closeMenu();
                }
            });

            document.addEventListener("keydown", (event) => {
                if (event.key === "Escape") {
                    if (authBackdrop.classList.contains("is-visible")) {
                        closeAuthModal();
                    }
                    closeMenu();
                }
            });

            authBackdrop.addEventListener("click", (event) => {
                if (event.target === authBackdrop) {
                    closeAuthModal();
                }
            });

            cancelAuthButton?.addEventListener("click", () => {
                closeAuthModal();
            });

            authForm.addEventListener("submit", (event) => {
                event.preventDefault();
                const formData = new FormData(authForm);
                const name = formData.get("displayName").trim();
                const email = formData.get("email").trim().toLowerCase();

                if (!name || !email) {
                    return;
                }

                activeAccount = normalizeAccount({ name, email });
                persistAccount(activeAccount);
                updateAccountUI();
                closeAuthModal();
            });

            signOutButton?.addEventListener("click", () => {
                persistAccount(null);
                activeAccount = null;
                updateAccountUI();
            });
        } else {
            console.warn("Account UI failed to initialize.");
        }
    </script>
</body>
</html>
