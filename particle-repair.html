<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Particle Repair</title>
  <style>
    :root {
      --bg: #12060f;
      --panel: #2b0d18;
      --accent: #f5a3c7;
      --accent-strong: #d9557f;
      --text: #f3e6f1;
      --muted: rgba(243, 230, 241, 0.7);
      --line: rgba(255, 255, 255, 0.12);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at top, #40142b, var(--bg) 70%);
      padding: 24px;
    }
    main {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      gap: 24px;
    }
    header {
      background: rgba(43, 13, 24, 0.85);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 22px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
      display: grid;
      gap: 12px;
    }
    header h1 {
      margin: 0;
      font-size: 2rem;
    }
    header p {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }
    .nav-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid var(--line);
      color: var(--text);
      font-size: 0.85rem;
      text-decoration: none;
    }
    .chip.accent {
      background: var(--accent-strong);
      border-color: transparent;
      color: #2b0d18;
      font-weight: 600;
    }
    .panel {
      background: rgba(18, 6, 15, 0.7);
      border: 1px solid var(--line);
      border-radius: 20px;
      padding: 20px;
      display: grid;
      gap: 18px;
    }
    .sentence {
      font-size: 1.15rem;
      line-height: 2;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }
    .slot {
      min-width: 56px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px dashed rgba(245, 163, 199, 0.6);
      text-align: center;
      font-weight: 600;
      color: var(--accent);
      cursor: pointer;
      transition: border-color 0.2s ease, background 0.2s ease;
    }
    .slot.filled {
      border-style: solid;
      color: #2b0d18;
      background: var(--accent);
    }
    .slot.drag-over {
      border-color: var(--accent-strong);
      background: rgba(245, 163, 199, 0.2);
    }
    .palette {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .particle {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(245, 163, 199, 0.4);
      background: rgba(18, 6, 15, 0.4);
      color: var(--text);
      font-size: 0.95rem;
      cursor: grab;
      user-select: none;
    }
    .particle.selected {
      background: var(--accent-strong);
      color: #2b0d18;
      font-weight: 700;
      border-color: transparent;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    button {
      border-radius: 999px;
      border: 1px solid rgba(245, 163, 199, 0.4);
      background: rgba(18, 6, 15, 0.4);
      color: var(--text);
      padding: 10px 18px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    button.primary {
      background: var(--accent-strong);
      color: #2b0d18;
      border-color: transparent;
      font-weight: 600;
    }
    .results {
      border-top: 1px solid var(--line);
      padding-top: 16px;
      display: none;
    }
    .results.active {
      display: grid;
      gap: 10px;
    }
    .result-item {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      background: rgba(43, 13, 24, 0.6);
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid rgba(245, 163, 199, 0.2);
    }
    .result-item span.label {
      color: var(--muted);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>Particle Repair</h1>
      <p>Fill the blanks by dragging particles or clicking a particle then clicking a slot. Submit to reveal each particle role.</p>
      <div class="nav-row">
        <a class="chip accent" href="particles-games.html">Back to games</a>
        <a class="chip" href="particles-meaning-function.html">Study guide</a>
      </div>
    </header>

    <section class="panel">
      <div>
        <strong>Sentence</strong>
        <div class="sentence" aria-label="Sentence with particle slots">
          きょうは、
          <span class="slot" data-slot="0" aria-label="Slot 1"></span>
          学校
          <span class="slot" data-slot="1" aria-label="Slot 2"></span>
          行く前に、
          友だち
          <span class="slot" data-slot="2" aria-label="Slot 3"></span>
          メッセージを送りました。
        </div>
      </div>

      <div>
        <strong>Particle palette</strong>
        <div class="palette" aria-label="Particle palette">
          <span class="particle" draggable="true" data-particle="は">は</span>
          <span class="particle" draggable="true" data-particle="が">が</span>
          <span class="particle" draggable="true" data-particle="を">を</span>
          <span class="particle" draggable="true" data-particle="に">に</span>
          <span class="particle" draggable="true" data-particle="で">で</span>
          <span class="particle" draggable="true" data-particle="と">と</span>
          <span class="particle" draggable="true" data-particle="へ">へ</span>
          <span class="particle" draggable="true" data-particle="から">から</span>
          <span class="particle" draggable="true" data-particle="まで">まで</span>
        </div>
      </div>

      <div class="actions">
        <button class="primary" type="button" id="submit">Submit</button>
        <button type="button" id="reset">Reset</button>
      </div>

      <div class="results" id="results" aria-live="polite">
        <strong>Particle roles</strong>
        <div class="result-item" id="result-0"></div>
        <div class="result-item" id="result-1"></div>
        <div class="result-item" id="result-2"></div>
      </div>
    </section>
  </main>

  <script>
    const slots = Array.from(document.querySelectorAll(".slot"));
    const particles = Array.from(document.querySelectorAll(".particle"));
    const submitButton = document.getElementById("submit");
    const resetButton = document.getElementById("reset");
    const results = document.getElementById("results");
    const roleMap = [
      "Topic marker",
      "Destination marker",
      "Indirect object marker"
    ];

    let selectedParticle = null;

    const clearSelection = () => {
      particles.forEach((particle) => particle.classList.remove("selected"));
      selectedParticle = null;
    };

    const setSlotValue = (slot, value) => {
      slot.textContent = value;
      if (value) {
        slot.classList.add("filled");
      } else {
        slot.classList.remove("filled");
      }
    };

    particles.forEach((particle) => {
      particle.addEventListener("click", () => {
        particles.forEach((item) => item.classList.remove("selected"));
        particle.classList.add("selected");
        selectedParticle = particle.dataset.particle;
      });

      particle.addEventListener("dragstart", (event) => {
        event.dataTransfer.setData("text/plain", particle.dataset.particle);
      });
    });

    slots.forEach((slot) => {
      slot.addEventListener("click", () => {
        if (!selectedParticle) {
          return;
        }
        setSlotValue(slot, selectedParticle);
      });

      slot.addEventListener("dragover", (event) => {
        event.preventDefault();
        slot.classList.add("drag-over");
      });

      slot.addEventListener("dragleave", () => {
        slot.classList.remove("drag-over");
      });

      slot.addEventListener("drop", (event) => {
        event.preventDefault();
        slot.classList.remove("drag-over");
        const particleValue = event.dataTransfer.getData("text/plain");
        if (particleValue) {
          setSlotValue(slot, particleValue);
        }
      });
    });

    submitButton.addEventListener("click", () => {
      slots.forEach((slot, index) => {
        const value = slot.textContent || "(blank)";
        const target = document.getElementById(`result-${index}`);
        target.innerHTML = `
          <span class="label">Slot ${index + 1}</span>
          <strong>${value}</strong>
          <span class="label">${roleMap[index]}</span>
        `;
      });
      results.classList.add("active");
      clearSelection();
    });

    resetButton.addEventListener("click", () => {
      slots.forEach((slot) => setSlotValue(slot, ""));
      results.classList.remove("active");
      results.querySelectorAll(".result-item").forEach((item) => (item.textContent = ""));
      clearSelection();
    });
  </script>
</body>
</html>
