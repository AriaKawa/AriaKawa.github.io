<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bass Fret Trainer</title>
<style>
  :root{
    --bg:#0b0f16;
    --panel:#0f1624;
    --wood1:#6b4a2d;
    --wood2:#8b5e36;
    --metal:#cfd8dc;
    --fret:#c0c9d2;
    --string:#e5e7eb;
    --nut:#d6dee6;
    --dot:#1f2937;
    --accent:#38bdf8;
    --good:#22c55e;
    --bad:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:radial-gradient(1200px 800px at 70% -10%, #142032 0%, var(--bg) 50%);
    display:flex; align-items:center; justify-content:center; padding:12px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    color:#e7eefc;
  }
  .app{
    width:min(1600px, 98vw);
    background:linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08);
    border-radius:18px;
    box-shadow: 0 20px 50px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.05);
    overflow:hidden;
  }
  .board{
    position:relative;
    width:100%;
    aspect-ratio: 1246 / 439;
    background:
      radial-gradient(120% 140% at 50% 50%, rgba(12,18,30,.9), rgba(7,11,20,.95)),
      #05070d;
    background-image:
      url("https://cdn.discordapp.com/attachments/1167576096076023920/1319187523703359519/cor_bass_heroN4SR35DR.png"),
      radial-gradient(120% 140% at 50% 50%, rgba(12,18,30,.9), rgba(7,11,20,.95));
    background-size: contain, cover;
    background-position: center;
    background-repeat: no-repeat;
    overflow:hidden;
  }
  svg{display:block; width:100%; height:100%; position:absolute; inset:0; pointer-events:none;}
  .controls{
    display:flex; align-items:center; justify-content:center; gap:10px;
    padding:10px; background:linear-gradient(180deg, #0e1523, #0c1320);
    border-top:1px solid rgba(255,255,255,.06);
  }
  .notes{
    display:grid;
    grid-template-columns: repeat(12, minmax(40px, 1fr));
    gap:8px; width:100%; max-width:980px;
  }
  button.note{
    appearance:none; border:none; cursor:pointer;
    padding:.8rem 0; border-radius:12px;
    background:linear-gradient(180deg, #0f1b2d, #0b1422);
    border:1px solid rgba(255,255,255,.08);
    color:#eaf2ff; font-weight:700; font-size:1.05rem; letter-spacing:.5px;
    box-shadow: 0 6px 16px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    transition: transform .06s ease, background .2s ease, border-color .2s ease;
  }
  button.note:active{ transform:translateY(1px) scale(.995) }
  button.note:hover{ border-color: rgba(255,255,255,.18) }
  .bar{
    display:flex; align-items:center; gap:10px; justify-content:space-between;
    padding:12px 14px; border-top:1px solid rgba(255,255,255,.06);
    background:linear-gradient(180deg, #0f1829, #0d1422);
  }
  .left, .right{display:flex; align-items:center; gap:8px}
  .iconbtn{
    width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
    border:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg, #0e1727, #0b1220);
    color:#cfe8ff; cursor:pointer; transition:.2s;
    box-shadow: 0 6px 16px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    user-select:none;
  }
  .iconbtn:hover{ border-color: rgba(255,255,255,.18) }
  .pill{
    min-width:40px; height:40px; padding:0 12px; border-radius:999px;
    display:flex; align-items:center; justify-content:center; gap:6px;
    border:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg, #0e1727, #0b1220);
    box-shadow: 0 6px 16px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    font-weight:700; letter-spacing:.3px;
  }
  .light{ opacity:.75 }
  .flash{
    position:absolute; inset:0; pointer-events:none; opacity:0;
    transition: opacity .18s ease;
  }
  .flash.good{ background: radial-gradient(70% 60% at 50% 50%, rgba(34,197,94,.18), transparent 70%) }
  .flash.bad{  background: radial-gradient(70% 60% at 50% 50%, rgba(239,68,68,.20), transparent 70%) }
  .flash.show{ opacity:1 }
  .highlight-glow{
    filter: drop-shadow(0 0 16px rgba(56,189,248,.85)) drop-shadow(0 0 32px rgba(56,189,248,.55));
  }
  .fret-target{
    fill: rgba(56,189,248,.18);
    stroke: rgba(56,189,248,.45);
    stroke-width:3;
    mix-blend-mode: screen;
  }
  .string-target{
    fill: rgba(56,189,248,.75);
    mix-blend-mode: screen;
  }
  @media (max-width:720px){
    .notes{gap:6px}
    button.note{font-size:1rem; padding:.7rem 0}
    .iconbtn{width:36px; height:36px; border-radius:10px}
    .pill{height:36px; padding:0 10px}
  }
</style>
</head>
<body>
  <div class="app">
    <div class="board" id="board">
      <!-- feedback flashes -->
      <div class="flash" id="flash"></div>
      <!-- SVG fretboard -->
      <svg id="fretSVG" viewBox="0 0 1246 439" aria-label="Bass Fretboard" role="img">
        <!-- wood background handled by CSS -->
        <!-- fret slots group (for layering) -->
        <g id="frets"></g>

        <!-- inlay dots -->
        <g id="inlays"></g>

        <!-- strings -->
        <g id="strings"></g>

        <!-- highlight target (string+fret) -->
        <g id="target"></g>

      </svg>
    </div>

    <div class="bar">
      <div class="left">
        <!-- ‚ôØ / ‚ô≠ toggle -->
        <div class="iconbtn" id="accToggle" title="Toggle sharps/flats" aria-label="Toggle sharps/flats">‚ôØ/‚ô≠</div>
        <!-- reveal helper (shows answer briefly) -->
        <div class="iconbtn" id="reveal" title="Peek" aria-label="Peek">üëÅÔ∏è</div>
      </div>
      <div class="right">
        <!-- streak pill (no words) -->
        <div class="pill" id="streak" aria-label="Streak">‚úÖ√ó0</div>
        <!-- reset -->
        <div class="iconbtn" id="reset" title="Reset" aria-label="Reset">‚ü≤</div>
      </div>
    </div>

    <div class="controls">
      <div class="notes" id="noteButtons"></div>
    </div>
  </div>

<script>
(()=>{
  // ---------- Constants ----------
  const SHARP = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
  const FLAT  = ["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];
  // Standard 4-string bass tuning, top to bottom visually: G, D, A, E
  const OPEN_STRING_NOTES = { G:7, D:2, A:9, E:4 }; // indices in SHARP
  const STRINGS_ORDER = ["G","D","A","E"]; // render order top->bottom
  const NUM_FRETS = 12; // choose range (0..12). Change if you want more
  // Tuned to the provided photograph ‚Äî tweak these numbers to realign the overlay if you swap imagery
  const FRETBOARD = {
    left: 300,
    right: 1044,
    top: 148,
    bottom: 292
  };
  const SCALE_PX = (FRETBOARD.right - FRETBOARD.left) * 2;
  const FRET_PAD_X = 10;
  const FRET_PAD_Y = 20;

  // ---------- State ----------
  let useSharps = true;
  let current = { stringIndex: 0, fret: 0, answerIdx: 0 };
  let streak = 0;
  let peekTimeout = null;

  // ---------- DOM ----------
  const fretSVG  = document.getElementById('fretSVG');
  const fretsG   = document.getElementById('frets');
  const stringsG = document.getElementById('strings');
  const inlaysG  = document.getElementById('inlays');
  const targetG  = document.getElementById('target');
  const noteButtons = document.getElementById('noteButtons');
  const flashEl  = document.getElementById('flash');
  const streakEl = document.getElementById('streak');
  const accToggle= document.getElementById('accToggle');
  const revealBtn= document.getElementById('reveal');
  const resetBtn = document.getElementById('reset');

  // ---------- Geometry Helpers ----------
  const fretXs = []; // x of each fret line
  (function computeFrets(){
    for(let i=0;i<=NUM_FRETS;i++){
      const ratio = 1 - Math.pow(2, -i/12);
      const x = FRETBOARD.right - SCALE_PX * ratio;
      fretXs[i] = x;
    }
  })();

  function stringY(i){
    // 4 strings across usable height
    const innerH = FRETBOARD.bottom - FRETBOARD.top;
    return FRETBOARD.top + (innerH)*(i/(STRINGS_ORDER.length-1));
  }

  function midBetween(a,b){ return a + (b-a)/2 }

  // ---------- Build Fretboard ----------
  const SVG_NS = "http://www.w3.org/2000/svg";

  function ensureDefs(){
    let defs = fretSVG.querySelector('defs');
    if(!defs){
      defs = document.createElementNS(SVG_NS, 'defs');
      fretSVG.insertBefore(defs, fretSVG.firstChild);
    }
    return defs;
  }

  function defineLinearGradient(id, stops, attrs={}){
    const defs = ensureDefs();
    let gradient = defs.querySelector(`#${id}`);
    if(!gradient){
      gradient = document.createElementNS(SVG_NS, 'linearGradient');
      gradient.setAttribute('id', id);
      Object.entries(attrs).forEach(([key,value])=> gradient.setAttribute(key, value));
      defs.appendChild(gradient);
    }else{
      while(gradient.firstChild) gradient.removeChild(gradient.firstChild);
    }
    stops.forEach(stop => {
      const stopEl = document.createElementNS(SVG_NS, 'stop');
      stopEl.setAttribute('offset', stop.offset);
      stopEl.setAttribute('stop-color', stop.color);
      if(stop.opacity !== undefined) stopEl.setAttribute('stop-opacity', stop.opacity);
      gradient.appendChild(stopEl);
    });
    return `url(#${id})`;
  }

  const fretFill = defineLinearGradient('fretMetal', [
    { offset: '0%',  color: 'rgba(246,250,255,.85)' },
    { offset: '45%', color: 'rgba(192,202,214,.95)' },
    { offset: '100%',color: 'rgba(109,123,139,.85)' }
  ], { x1: '0%', y1: '0%', x2: '0%', y2: '100%' });

  const nutFill = defineLinearGradient('nutMetal', [
    { offset: '0%',  color: 'rgba(255,255,255,.92)' },
    { offset: '55%', color: 'rgba(212,223,233,.95)' },
    { offset: '100%',color: 'rgba(165,177,189,.9)' }
  ], { x1: '0%', y1: '0%', x2: '0%', y2: '100%' });

  const stringFill = defineLinearGradient('stringMetal', [
    { offset: '0%',  color: 'rgba(42,51,63,.75)', opacity: .85 },
    { offset: '30%', color: 'rgba(230,235,240,.95)' },
    { offset: '55%', color: 'rgba(165,175,186,.9)' },
    { offset: '100%',color: 'rgba(42,51,63,.78)', opacity: .88 }
  ], { x1: '0%', y1: '0%', x2: '100%', y2: '0%' });

  function drawFrets(){
    fretsG.innerHTML = "";

    const fragment = document.createDocumentFragment();
    const fretHeight = (FRETBOARD.bottom - FRETBOARD.top) + FRET_PAD_Y*2;
    const fretY = FRETBOARD.top - FRET_PAD_Y;

    const nutWidth = 16;
    const nut = document.createElementNS(SVG_NS, 'rect');
    nut.setAttribute('x', fretXs[0] - nutWidth/2);
    nut.setAttribute('y', fretY);
    nut.setAttribute('width', nutWidth);
    nut.setAttribute('height', fretHeight);
    nut.setAttribute('rx', 4);
    nut.setAttribute('fill', nutFill);
    nut.setAttribute('stroke', 'rgba(255,255,255,.65)');
    nut.setAttribute('stroke-width', '1.2');
    fragment.appendChild(nut);

    for(let i=1;i<=NUM_FRETS;i++){
      const x = fretXs[i];
      const fretWidth = (i % 12 === 0) ? 6 : 4;
      const fret = document.createElementNS(SVG_NS, 'rect');
      fret.setAttribute('x', x - fretWidth/2);
      fret.setAttribute('y', fretY);
      fret.setAttribute('width', fretWidth);
      fret.setAttribute('height', fretHeight);
      fret.setAttribute('rx', 2.5);
      fret.setAttribute('fill', fretFill);
      fret.setAttribute('stroke', 'rgba(15,23,42,.45)');
      fret.setAttribute('stroke-width', '0.9');
      fret.setAttribute('opacity', i % 12 === 0 ? 0.95 : 0.88);
      fragment.appendChild(fret);

      const sheen = document.createElementNS(SVG_NS, 'line');
      sheen.setAttribute('x1', x - fretWidth/2 + 0.6);
      sheen.setAttribute('x2', x + fretWidth/2 - 0.6);
      sheen.setAttribute('y1', fretY + 6);
      sheen.setAttribute('y2', fretY + fretHeight - 6);
      sheen.setAttribute('stroke', 'rgba(255,255,255,.25)');
      sheen.setAttribute('stroke-width', '0.7');
      sheen.setAttribute('stroke-linecap', 'round');
      fragment.appendChild(sheen);
    }

    fretsG.appendChild(fragment);
  }

  function drawInlays(){
    inlaysG.innerHTML = "";

    const fragment = document.createDocumentFragment();
    const centerY = midBetween(FRETBOARD.top, FRETBOARD.bottom);
    const radius = 13;
    const standardInlays = [3,5,7,9,12,15,17,19,21,24];

    standardInlays.forEach(fretNum => {
      if(fretNum > NUM_FRETS) return;
      const prevIdx = fretNum - 1;
      const nextIdx = fretNum;
      if(prevIdx < 0 || nextIdx >= fretXs.length) return;
      const cx = midBetween(fretXs[prevIdx], fretXs[nextIdx]);
      const isDouble = fretNum % 12 === 0;

      if(isDouble){
        const offset = radius * 1.35;
        fragment.appendChild(circle(cx, centerY - offset, radius * 0.85, 'rgba(230,235,242,.94)', 1, 'rgba(30,41,59,.3)', 1));
        fragment.appendChild(circle(cx, centerY + offset, radius * 0.85, 'rgba(230,235,242,.94)', 1, 'rgba(30,41,59,.3)', 1));
      }else{
        fragment.appendChild(circle(cx, centerY, radius, 'rgba(225,231,238,.9)', 1, 'rgba(30,41,59,.28)', 0.9));
      }
    });

    inlaysG.appendChild(fragment);
  }

  function drawStrings(){
    stringsG.innerHTML = "";

    const fragment = document.createDocumentFragment();
    const lengths = FRETBOARD.right - FRETBOARD.left + FRET_PAD_X*2;
    const startX = FRETBOARD.left - FRET_PAD_X;
    const gauges = [4.2, 5.6, 7.6, 9.8];

    STRINGS_ORDER.forEach((_, i) => {
      const y = stringY(i);
      const thickness = gauges[i];
      const string = document.createElementNS(SVG_NS, 'rect');
      string.setAttribute('x', startX);
      string.setAttribute('y', y - thickness/2);
      string.setAttribute('width', lengths);
      string.setAttribute('height', thickness);
      string.setAttribute('rx', thickness/2);
      string.setAttribute('fill', stringFill);
      string.setAttribute('stroke', 'rgba(15,23,42,.55)');
      string.setAttribute('stroke-width', '0.6');
      string.setAttribute('opacity', 0.96);

      const wrap = document.createElementNS(SVG_NS, 'line');
      wrap.setAttribute('x1', startX + lengths * 0.08);
      wrap.setAttribute('x2', startX + lengths * 0.92);
      wrap.setAttribute('y1', y);
      wrap.setAttribute('y2', y);
      wrap.setAttribute('stroke', 'rgba(255,255,255,.18)');
      wrap.setAttribute('stroke-width', Math.max(1.2, thickness * 0.18));
      wrap.setAttribute('stroke-linecap', 'round');

      fragment.appendChild(string);
      fragment.appendChild(wrap);
    });

    stringsG.appendChild(fragment);
  }

  function circle(cx, cy, r, fill, opacity=1, stroke=null, strokeWidth=null){
    const c = document.createElementNS(SVG_NS,'circle');
    c.setAttribute('cx', cx);
    c.setAttribute('cy', cy);
    c.setAttribute('r', r);
    c.setAttribute('fill', fill);
    c.setAttribute('opacity', opacity);
    if(stroke){
      c.setAttribute('stroke', stroke);
      if(strokeWidth !== null) c.setAttribute('stroke-width', strokeWidth);
    }
    return c;
  }
  // ---------- Target Highlight ----------
  function renderTarget(){
    targetG.innerHTML = "";
    const i = current.stringIndex;
    const f = current.fret;

    // glowing puck at the middle of the fret segment on that string
    const startX = Math.min(fretXs[f], fretXs[f+1]);
    const endX = Math.max(fretXs[f], fretXs[f+1]);
    const width = endX - startX;
    const cx = midBetween(startX, endX);
    const cy = stringY(i);

    const fretRect = document.createElementNS("http://www.w3.org/2000/svg","rect");
    fretRect.setAttribute("x", startX - FRET_PAD_X);
    fretRect.setAttribute("y", FRETBOARD.top - FRET_PAD_Y);
    fretRect.setAttribute("width", width + FRET_PAD_X*2);
    fretRect.setAttribute("height", (FRETBOARD.bottom - FRETBOARD.top) + FRET_PAD_Y*2);
    fretRect.setAttribute("rx", 18);
    fretRect.setAttribute("ry", 18);
    fretRect.classList.add('fret-target','highlight-glow');

    const stringRect = document.createElementNS("http://www.w3.org/2000/svg","rect");
    const stringHeight = 7;
    const innerWidth = Math.max(12, width - 36);
    const stringX = startX + (width - innerWidth)/2;
    stringRect.setAttribute("x", stringX);
    stringRect.setAttribute("y", cy - stringHeight/2);
    stringRect.setAttribute("width", innerWidth);
    stringRect.setAttribute("height", stringHeight);
    stringRect.setAttribute("rx", stringHeight/2);
    stringRect.classList.add('string-target','highlight-glow');

    const core  = circle(cx, cy, 7.5, "var(--accent)", 1);

    targetG.appendChild(fretRect);
    targetG.appendChild(stringRect);
    targetG.appendChild(core);
  }

  // ---------- Notes & Answers ----------
  const enharmonics = {
    "A#":"Bb","Bb":"A#",
    "C#":"Db","Db":"C#",
    "D#":"Eb","Eb":"D#",
    "F#":"Gb","Gb":"F#",
    "G#":"Ab","Ab":"G#"
  };

  function idxFromName(name){
    const i = SHARP.indexOf(name);
    if(i !== -1) return i;
    // maybe it's a flat name
    const j = FLAT.indexOf(name);
    return j;
  }

  function noteAt(stringIndex, fret){
    const openName = STRINGS_ORDER[stringIndex];
    const openIdx = OPEN_STRING_NOTES[openName];
    return (openIdx + fret) % 12;
  }

  function nextQuestion(){
    // random string 0..3, random fret 0..NUM_FRETS (inclusive of 0 exclusive of last segment for target)
    current.stringIndex = Math.floor(Math.random()*STRINGS_ORDER.length);
    current.fret = Math.floor(Math.random()*NUM_FRETS); // 0..11 if NUM_FRETS=12 (uses segment before next line)
    current.answerIdx = noteAt(current.stringIndex, current.fret);
    renderTarget();
  }

  // ---------- Buttons ----------
  function renderButtons(){
    noteButtons.innerHTML = "";
    const labels = useSharps ? SHARP : FLAT;
    labels.forEach(n=>{
      const btn = document.createElement('button');
      btn.className = 'note';
      btn.textContent = n;
      btn.setAttribute('aria-label', n);
      btn.addEventListener('click', ()=> handleGuess(n));
      noteButtons.appendChild(btn);
    });
  }

  function answersMatch(guessName, answerIdx){
    const guessIdx = idxFromName(guessName);
    if(guessIdx === answerIdx) return true;
    // accept enharmonic equivalents (e.g., Bb vs A#)
    const alt = enharmonics[guessName];
    if(alt){
      const altIdx = idxFromName(alt);
      return altIdx === answerIdx;
    }
    return false;
  }

  function flash(type){
    flashEl.className = 'flash ' + (type==='good' ? 'good' : 'bad') + ' show';
    setTimeout(()=> flashEl.classList.remove('show'), 160);
  }

  function handleGuess(name){
    if(answersMatch(name, current.answerIdx)){
      streak++;
      streakEl.textContent = "‚úÖ√ó"+streak;
      flash('good');
      nextQuestion();
    }else{
      streak = 0;
      streakEl.textContent = "‚úÖ√ó0";
      flash('bad');
      // brief wobble animation on target
      wobbleTarget();
    }
  }

  function wobbleTarget(){
    targetG.animate([
      { transform: 'translateX(0px)' },
      { transform: 'translateX(-6px)' },
      { transform: 'translateX(6px)' },
      { transform: 'translateX(0px)' },
    ], { duration: 180, easing: 'ease-out' });
  }

  // ---------- Peek / Reset / Toggle ----------
  accToggle.addEventListener('click', ()=>{
    useSharps = !useSharps;
    renderButtons();
  });

  revealBtn.addEventListener('click', ()=>{
    if(peekTimeout) { clearTimeout(peekTimeout); peekTimeout=null; }
    // show answer as a soft ring that fades
    const cx = midBetween(fretXs[current.fret], fretXs[current.fret+1]);
    const cy = stringY(current.stringIndex);
    const ring = document.createElementNS("http://www.w3.org/2000/svg","circle");
    ring.setAttribute("cx", cx); ring.setAttribute("cy", cy);
    ring.setAttribute("r", 52); ring.setAttribute("fill","none");
    ring.setAttribute("stroke","rgba(255,255,255,.28)");
    ring.setAttribute("stroke-width","4");
    targetG.appendChild(ring);
    ring.animate([{opacity:1, r:52},{opacity:0, r:88}], {duration:650, easing:'ease-out'}).onfinish=()=> ring.remove();
  });

  resetBtn.addEventListener('click', ()=>{
    streak = 0; streakEl.textContent = "‚úÖ√ó0";
    nextQuestion();
  });

  // ---------- Init ----------
  function init(){
    drawFrets();
    drawInlays();
    drawStrings();
    renderButtons();
    nextQuestion();
  }
  init();

  // Optional: keyboard input (A..G with optional # or b). No labels shown; just a convenience.
  const keyMap = new Set(["A","B","C","D","E","F","G","#","b"]);
  let lastLetter = null;
  window.addEventListener('keydown', (e)=>{
    const k = e.key.toUpperCase();
    if(!keyMap.has(k) && k !== "ARROWRIGHT" && k!==" "){ return; }
    if(k===" " || k==="ARROWRIGHT"){ e.preventDefault(); nextQuestion(); return; }
    if("ABCDEFG".includes(k)){
      lastLetter = k;
      // if single letter is a complete note (A,B,C,D,E,F,G) it might be enough; wait briefly for accidental
      setTimeout(()=>{ if(lastLetter){ handleGuess(lastLetter); lastLetter=null; } }, 180);
    }else if(k==="#" || e.key==="b"){
      if(lastLetter){
        const name = lastLetter + (k==="#" ? "#" : "b");
        lastLetter = null;
        handleGuess(name);
      }
    }
  });

})();
</script>
</body>
</html>
