<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pok√©mon Type Trainer</title>
<style>
  :root{
    --bg:#040812;
    --surface:rgba(12,20,36,0.92);
    --surface-strong:rgba(16,27,46,0.94);
    --border:rgba(255,255,255,0.08);
    --border-strong:rgba(148,163,184,0.25);
    --text:#f8fafc;
    --title:#e2e8f0;
    --muted:#94a3b8;
    --muted-soft:rgba(148,163,184,0.18);
    --accent:#38bdf8;
    --good:#34d399;
    --bad:#f87171;
    --focus-super:#f97316;
    --focus-notvery:#38bdf8;
    --focus-immune:#fde047;
    --focus-resist:#c084fc;
  }
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%;}
  body{
    margin:0;
    background:radial-gradient(1200px 800px at 50% -200px,rgba(30,64,175,0.25) 0%,#020617 35%,var(--bg) 100%);
    color:var(--text);
    font:16px/1.5 "Inter", "Segoe UI", Roboto, system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:40px 20px 80px;
  }
  .app{width:min(1080px,100%);}
  .top{display:flex;justify-content:space-between;align-items:center;gap:24px;margin-bottom:32px;flex-wrap:wrap;}
  .brand{display:flex;flex-direction:column;gap:6px;min-width:240px;}
  .brand h1{margin:0;font-size:clamp(28px,4vw,38px);font-weight:800;letter-spacing:.6px;}
  .brand p{margin:0;color:var(--muted);font-size:15px;}
  .scoreboard{display:flex;gap:14px;flex-wrap:wrap;}
  .score-box{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:12px 18px;min-width:96px;text-align:center;box-shadow:0 14px 28px -20px rgba(15,118,250,0.45);}
  .score-box span{display:block;text-transform:uppercase;letter-spacing:.12em;font-size:11px;color:var(--muted);margin-bottom:6px;}
  .score-box strong{display:block;font-size:26px;letter-spacing:.04em;}
  main{display:flex;flex-direction:column;gap:32px;}
  .view{animation:fadeIn .45s ease;}
  .hidden{display:none !important;}

  #intro{padding:56px 20px;text-align:center;background:var(--surface);border-radius:24px;border:1px solid var(--border);box-shadow:0 40px 120px -60px rgba(37,99,235,0.5);}
  #intro h2{margin:0;font-size:clamp(26px,3.6vw,36px);font-weight:800;letter-spacing:.5px;}
  #intro p{margin:16px auto 32px;max-width:520px;color:var(--muted);font-size:17px;}

  .btn{border:none;border-radius:999px;padding:14px 28px;font-weight:700;letter-spacing:.04em;font-size:15px;cursor:pointer;color:var(--text);background:linear-gradient(135deg,#2563eb,#38bdf8);box-shadow:0 20px 40px -24px rgba(56,189,248,0.85);transition:transform .18s ease, box-shadow .18s ease;}
  .btn:hover{transform:translateY(-2px);box-shadow:0 24px 48px -20px rgba(56,189,248,0.85);}
  .btn:active{transform:translateY(0);}
  .btn.primary{background:linear-gradient(135deg,#16a34a,#34d399);box-shadow:0 22px 42px -22px rgba(34,197,94,0.7);}
  .btn.primary:hover{box-shadow:0 26px 56px -22px rgba(34,197,94,0.72);}
  .btn.alt{background:linear-gradient(135deg,#1e293b,#334155);box-shadow:0 18px 36px -24px rgba(15,23,42,0.8);}
  .btn[disabled]{opacity:.5;cursor:not-allowed;box-shadow:none;}

  .link-btn{border:none;background:none;color:var(--muted);font-weight:600;letter-spacing:.04em;padding:0;cursor:pointer;display:inline-flex;align-items:center;gap:6px;font-size:14px;}
  .link-btn:hover{color:var(--text);}

  #focusView{background:var(--surface-strong);border-radius:24px;padding:42px;border:1px solid var(--border);box-shadow:0 32px 90px -60px rgba(30,58,138,0.65);}
  #focusView header{display:flex;flex-direction:column;gap:10px;margin-bottom:32px;text-align:center;}
  #focusView h2{margin:0;font-size:clamp(24px,3.4vw,34px);font-weight:800;}
  #focusView p{margin:0;color:var(--muted);font-size:16px;}
  .focus-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:22px;}
  .focus-card{position:relative;overflow:hidden;padding:26px 24px;border-radius:22px;border:1px solid var(--border-strong);background:linear-gradient(160deg,rgba(148,163,184,0.08),rgba(15,23,42,0.95));display:flex;flex-direction:column;gap:14px;align-items:flex-start;text-align:left;cursor:pointer;transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;min-height:204px;color:var(--text);--card-accent:var(--accent);--card-soft:rgba(56,189,248,0.35);--card-border:rgba(56,189,248,0.45);}
  .focus-card::after{content:"";position:absolute;inset:0;background:radial-gradient(160px 160px at 100% -20%,var(--card-soft,rgba(56,189,248,0.35)) 0%,transparent 70%);opacity:.9;pointer-events:none;transition:opacity .2s ease;}
  .focus-card .focus-icon{font-size:36px;display:inline-flex;align-items:center;justify-content:center;width:64px;height:64px;border-radius:18px;background:rgba(15,23,42,0.75);border:1px solid var(--card-border,rgba(148,163,184,0.35));color:var(--card-accent);box-shadow:0 18px 36px -26px var(--card-soft,rgba(56,189,248,0.4));}
  .focus-card h3{margin:0;font-size:20px;font-weight:700;letter-spacing:.04em;}
  .focus-card p{margin:0;color:var(--muted);font-size:15px;line-height:1.45;}
  .focus-card:hover{transform:translateY(-6px);box-shadow:0 26px 70px -48px var(--card-soft,rgba(59,130,246,0.65));border-color:var(--card-border,rgba(148,163,184,0.38));}
  .focus-card:hover::after{opacity:1;}
  .focus-card:active{transform:translateY(-2px);}
  .focus-card[data-focus="super"]{--card-accent:var(--focus-super);--card-soft:rgba(249,115,22,0.34);--card-border:rgba(249,115,22,0.45);}
  .focus-card[data-focus="notvery"]{--card-accent:var(--focus-notvery);--card-soft:rgba(56,189,248,0.34);--card-border:rgba(56,189,248,0.45);}
  .focus-card[data-focus="immune"]{--card-accent:var(--focus-immune);--card-soft:rgba(253,224,71,0.32);--card-border:rgba(253,224,71,0.45);}
  .focus-card[data-focus="resist"]{--card-accent:var(--focus-resist);--card-soft:rgba(192,132,252,0.32);--card-border:rgba(192,132,252,0.45);}

  #quizView{display:flex;flex-direction:column;gap:22px;}
  .quiz-shell{background:var(--surface-strong);border-radius:26px;padding:36px 32px;border:1px solid var(--border);box-shadow:0 36px 90px -60px rgba(30,58,138,0.7);}
  .quiz-header{display:flex;justify-content:center;align-items:center;gap:12px;margin-bottom:24px;flex-wrap:wrap;}
  .focus-tag{padding:10px 18px;border-radius:999px;border:1px solid var(--border-strong);font-weight:700;letter-spacing:.08em;text-transform:uppercase;font-size:13px;color:var(--muted);background:rgba(148,163,184,0.14);display:inline-flex;align-items:center;gap:8px;}
  .focus-tag span{font-size:16px;}
  .focus-tag[data-focus="super"]{color:var(--focus-super);border-color:rgba(249,115,22,0.45);background:rgba(249,115,22,0.12);}
  .focus-tag[data-focus="notvery"]{color:var(--focus-notvery);border-color:rgba(56,189,248,0.45);background:rgba(56,189,248,0.12);}
  .focus-tag[data-focus="immune"]{color:#facc15;border-color:rgba(250,204,21,0.55);background:rgba(250,204,21,0.12);}
  .focus-tag[data-focus="resist"]{color:var(--focus-resist);border-color:rgba(192,132,252,0.5);background:rgba(192,132,252,0.12);}

  .defender-card{text-align:center;display:flex;flex-direction:column;gap:18px;align-items:center;margin-bottom:18px;}
  .poke-name{font-size:clamp(30px,4.2vw,42px);font-weight:800;letter-spacing:.5px;margin:0;}
  .poke-types{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;}
  .type-chip{display:inline-flex;align-items:center;justify-content:center;padding:8px 14px;border-radius:999px;font-weight:700;letter-spacing:.02em;background:linear-gradient(135deg,rgba(255,255,255,0.22),rgba(255,255,255,0.05));border:1px solid rgba(255,255,255,0.2);color:#020817;min-width:64px;box-shadow:0 12px 26px -20px rgba(15,23,42,0.9);}
  .prompt{margin:0;color:var(--muted);font-size:17px;max-width:720px;text-align:center;}
  .focus-note{margin:8px auto 0;color:rgba(250,204,21,0.9);font-size:14px;font-weight:600;letter-spacing:.03em;text-align:center;max-width:640px;}

  .type-grid{margin-top:28px;display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:14px;}
  .type-pill{position:relative;border-radius:18px;padding:12px 14px;border:1px solid rgba(15,23,42,0.8);font-weight:700;font-size:15px;text-align:center;cursor:pointer;background:linear-gradient(135deg,rgba(255,255,255,0.18),rgba(15,23,42,0.85)),var(--c,rgba(71,85,105,0.85));color:#010409;transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, opacity .18s ease;user-select:none;}
  .type-pill:hover{transform:translateY(-2px);}
  .type-pill[data-selected="true"]{box-shadow:0 0 0 3px rgba(148,197,255,0.65),0 28px 52px -28px rgba(56,189,248,0.9);border-color:rgba(148,197,255,0.7);transform:translateY(-3px);}
  .type-pill[data-state="correct"]{box-shadow:0 0 0 3px rgba(34,197,94,0.75),0 24px 48px -26px rgba(34,197,94,0.55);border-color:rgba(34,197,94,0.6);}
  .type-pill[data-state="wrong"]{box-shadow:0 0 0 3px rgba(239,68,68,0.75),0 24px 48px -24px rgba(239,68,68,0.6);border-color:rgba(239,68,68,0.65);}
  .type-pill[data-state="missed"]{box-shadow:0 0 0 3px rgba(59,130,246,0.7),0 24px 48px -26px rgba(59,130,246,0.55);border-color:rgba(96,165,250,0.6);opacity:.92;}
  .type-pill[disabled]{cursor:default;opacity:.6;transform:none;}

  .actions{display:flex;justify-content:center;gap:14px;flex-wrap:wrap;margin-top:30px;}

  .result{margin-top:28px;padding:20px 24px;border-radius:20px;border:1px solid rgba(148,197,255,0.2);background:rgba(15,23,42,0.7);display:flex;align-items:center;gap:18px;transition:opacity .2s ease;}
  .result.hidden{display:none;}
  .result[data-state="good"]{border-color:rgba(34,197,94,0.45);background:rgba(34,197,94,0.12);}
  .result[data-state="bad"]{border-color:rgba(239,68,68,0.5);background:rgba(239,68,68,0.12);}
  .result-icon{width:54px;height:54px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:800;}
  .result[data-state="good"] .result-icon{background:rgba(34,197,94,0.18);color:#4ade80;}
  .result[data-state="bad"] .result-icon{background:rgba(239,68,68,0.2);color:#fca5a5;}
  .result-body{display:flex;flex-direction:column;gap:10px;}
  .result-body h4{margin:0;font-size:18px;font-weight:700;letter-spacing:.04em;}
  .result-body p{margin:0;color:var(--muted);font-size:14px;line-height:1.5;}
  .result-lines{display:flex;flex-direction:column;gap:10px;}
  .result-line{display:flex;flex-direction:column;gap:6px;font-size:14px;color:var(--muted);}
  .chip-row{display:flex;flex-wrap:wrap;gap:8px;}
  .chip-row .type-chip{padding:6px 12px;font-size:13px;border-radius:14px;box-shadow:none;}

  #changeFocus{align-self:center;margin-top:4px;}

  .type-chip.t-Normal{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#A8A77A;}
  .type-chip.t-Fire{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#EE8130;}
  .type-chip.t-Water{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#6390F0;}
  .type-chip.t-Electric{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#F7D02C;}
  .type-chip.t-Grass{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#7AC74C;}
  .type-chip.t-Ice{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#96D9D6;}
  .type-chip.t-Fighting{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#C22E28;}
  .type-chip.t-Poison{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#A33EA1;}
  .type-chip.t-Ground{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#E2BF65;}
  .type-chip.t-Flying{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#A98FF3;}
  .type-chip.t-Psychic{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#F95587;}
  .type-chip.t-Bug{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#A6B91A;}
  .type-chip.t-Rock{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#B6A136;}
  .type-chip.t-Ghost{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#735797;}
  .type-chip.t-Dragon{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#6F35FC;}
  .type-chip.t-Dark{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#705746;}
  .type-chip.t-Steel{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#B7B7CE;}
  .type-chip.t-Fairy{background:linear-gradient(135deg,rgba(255,255,255,0.25),rgba(226,232,240,0.1)),#D685AD;}

  .type-pill.t-Normal{--c:#A8A77A;}
  .type-pill.t-Fire{--c:#EE8130;}
  .type-pill.t-Water{--c:#6390F0;}
  .type-pill.t-Electric{--c:#F7D02C;}
  .type-pill.t-Grass{--c:#7AC74C;}
  .type-pill.t-Ice{--c:#96D9D6;}
  .type-pill.t-Fighting{--c:#C22E28;}
  .type-pill.t-Poison{--c:#A33EA1;}
  .type-pill.t-Ground{--c:#E2BF65;}
  .type-pill.t-Flying{--c:#A98FF3;}
  .type-pill.t-Psychic{--c:#F95587;}
  .type-pill.t-Bug{--c:#A6B91A;}
  .type-pill.t-Rock{--c:#B6A136;}
  .type-pill.t-Ghost{--c:#735797;}
  .type-pill.t-Dragon{--c:#6F35FC;}
  .type-pill.t-Dark{--c:#705746;}
  .type-pill.t-Steel{--c:#B7B7CE;}
  .type-pill.t-Fairy{--c:#D685AD;}

  @media(max-width:720px){
    body{padding:30px 16px 60px;}
    .brand{min-width:unset;}
    .quiz-shell{padding:28px 22px;}
    .type-grid{grid-template-columns:repeat(auto-fit,minmax(110px,1fr));}
  }
  @media(max-width:520px){
    .actions{flex-direction:column;}
    .scoreboard{justify-content:flex-start;}
    #focusView{padding:32px 22px;}
  }

  @keyframes fadeIn{
    from{opacity:0;transform:translateY(12px);}
    to{opacity:1;transform:translateY(0);}
  }
</style>
</head>
<body>
  <div class="app">
    <header class="top">
      <div class="brand">
        <h1>Pok√©mon Type Trainer</h1>
        <p>Sharpen your matchup memory with a focused drill.</p>
      </div>
      <div class="scoreboard">
        <div class="score-box"><span>Score</span><strong id="score">0</strong></div>
        <div class="score-box"><span>Streak</span><strong id="streak">0</strong></div>
        <div class="score-box"><span>Best</span><strong id="best">0</strong></div>
      </div>
    </header>

    <main>
      <section id="intro" class="view">
        <h2>Master the matchup chart</h2>
        <p>Jump into quick drills that target a specific effectiveness tier. Choose what you want to practise, then tap through randomized Pok√©mon to lock the type chart into muscle memory.</p>
        <button id="startBtn" class="btn">Start training</button>
      </section>

      <section id="focusView" class="view hidden">
        <header>
          <h2>Select your focus</h2>
          <p>What matchup tier do you want to drill right now?</p>
        </header>
        <div class="focus-grid">
          <button class="focus-card" data-focus="super">
            <span class="focus-icon">‚öîÔ∏è</span>
            <h3>Super Effective</h3>
            <p>Find the coverage moves that hit for √ó2 or √ó4 damage. Perfect for planning offense.</p>
          </button>
          <button class="focus-card" data-focus="notvery">
            <span class="focus-icon">üõ°Ô∏è</span>
            <h3>Not Very Effective</h3>
            <p>Memorize matchups that only deal √ó¬Ω damage so you know when a move is safe to shrug off.</p>
          </button>
          <button class="focus-card" data-focus="immune">
            <span class="focus-icon">‚õîÔ∏è</span>
            <h3>Immune</h3>
            <p>Spot the types that do zero damage. Never lose a turn to an immunity again.</p>
          </button>
          <button class="focus-card" data-focus="resist">
            <span class="focus-icon">üîÅ</span>
            <h3>Resist</h3>
            <p>Drill tricky double resistances (√ó¬º). When none exist, we fall back to regular resistances.</p>
          </button>
        </div>
        <div style="margin-top:26px;display:flex;justify-content:center;">
          <button id="backToIntro" class="link-btn">‚Üê Back</button>
        </div>
      </section>

      <section id="quizView" class="view hidden">
        <div class="quiz-shell">
          <div class="quiz-header">
            <div id="focusTag" class="focus-tag" data-focus="super"><span>‚òÖ</span><span>Super Effective practice</span></div>
          </div>
          <div class="defender-card">
            <h3 id="pokeName" class="poke-name">Charizard</h3>
            <div id="pokeTypes" class="poke-types"></div>
            <p id="promptText" class="prompt">Select all attack types that are super effective (√ó2 or √ó4).</p>
            <div id="focusNote" class="focus-note hidden"></div>
          </div>
          <div id="typeGrid" class="type-grid"></div>
          <div class="actions">
            <button id="submitBtn" class="btn primary">Check answer</button>
            <button id="nextBtn" class="btn alt" disabled>Next Pok√©mon</button>
          </div>
          <div id="result" class="result hidden" aria-live="polite">
            <div id="resultIcon" class="result-icon">‚úì</div>
            <div class="result-body">
              <h4 id="resultHeading">Great work!</h4>
              <div id="resultSummary" class="result-lines"></div>
            </div>
          </div>
        </div>
        <button id="changeFocus" class="link-btn">‚Üê Change focus</button>
      </section>
    </main>
  </div>

<script>
const TYPES = [
  'Normal','Fire','Water','Electric','Grass','Ice','Fighting','Poison','Ground','Flying','Psychic','Bug','Rock','Ghost','Dragon','Dark','Steel','Fairy'
];

const CHART = {
  Normal:   {Rock:.5, Steel:.5, Ghost:0},
  Fire:     {Grass:2, Ice:2, Bug:2, Steel:2, Fire:.5, Water:.5, Rock:.5, Dragon:.5},
  Water:    {Fire:2, Ground:2, Rock:2, Water:.5, Grass:.5, Dragon:.5},
  Electric: {Water:2, Flying:2, Electric:.5, Grass:.5, Dragon:.5, Ground:0},
  Grass:    {Water:2, Ground:2, Rock:2, Fire:.5, Grass:.5, Poison:.5, Flying:.5, Bug:.5, Dragon:.5, Steel:.5},
  Ice:      {Grass:2, Ground:2, Flying:2, Dragon:2, Fire:.5, Water:.5, Ice:.5, Steel:.5},
  Fighting: {Normal:2, Ice:2, Rock:2, Dark:2, Steel:2, Poison:.5, Flying:.5, Psychic:.5, Bug:.5, Fairy:.5, Ghost:0},
  Poison:   {Grass:2, Fairy:2, Poison:.5, Ground:.5, Rock:.5, Ghost:.5, Steel:0},
  Ground:   {Fire:2, Electric:2, Poison:2, Rock:2, Steel:2, Grass:.5, Bug:.5, Flying:0},
  Flying:   {Grass:2, Fighting:2, Bug:2, Electric:.5, Rock:.5, Steel:.5},
  Psychic:  {Fighting:2, Poison:2, Psychic:.5, Steel:.5, Dark:0},
  Bug:      {Grass:2, Psychic:2, Dark:2, Fire:.5, Fighting:.5, Poison:.5, Flying:.5, Ghost:.5, Steel:.5, Fairy:.5, Rock:.5},
  Rock:     {Fire:2, Ice:2, Flying:2, Bug:2, Fighting:.5, Ground:.5, Steel:.5},
  Ghost:    {Psychic:2, Ghost:2, Dark:.5, Normal:0},
  Dragon:   {Dragon:2, Steel:.5, Fairy:0},
  Dark:     {Psychic:2, Ghost:2, Fighting:.5, Dark:.5, Fairy:.5},
  Steel:    {Ice:2, Rock:2, Fairy:2, Fire:.5, Water:.5, Electric:.5, Steel:.5},
  Fairy:    {Fighting:2, Dragon:2, Dark:2, Fire:.5, Poison:.5, Steel:.5}
};

const ROSTER = [
  ['Charizard',['Fire','Flying']],
  ['Gyarados',['Water','Flying']],
  ['Gengar',['Ghost','Poison']],
  ['Tyranitar',['Rock','Dark']],
  ['Scizor',['Bug','Steel']],
  ['Dragonite',['Dragon','Flying']],
  ['Lucario',['Fighting','Steel']],
  ['Togekiss',['Fairy','Flying']],
  ['Sableye',['Dark','Ghost']],
  ['Excadrill',['Ground','Steel']],
  ['Swampert',['Water','Ground']],
  ['Ferrothorn',['Grass','Steel']],
  ['Mamoswine',['Ice','Ground']],
  ['Rotom-Wash',['Electric','Water']],
  ['Hydreigon',['Dark','Dragon']],
  ['Aegislash',['Steel','Ghost']],
  ['Marowak (Alola)',['Fire','Ghost']],
  ['Gliscor',['Ground','Flying']],
  ['Heatran',['Fire','Steel']],
  ['Skarmory',['Steel','Flying']],
  ['Haxorus',['Dragon']],
  ['Greninja',['Water','Dark']],
  ['Chandelure',['Ghost','Fire']],
  ['Rillaboom',['Grass']],
  ['Toxapex',['Water','Poison']],
  ['Corviknight',['Steel','Flying']],
  ['Dragapult',['Dragon','Ghost']]
];

const FOCUS = {
  super: {
    label: 'Super Effective',
    tagIcon: '‚ö°Ô∏è',
    prompt: 'Select every attack type that deals super-effective damage (√ó2 or √ó4).',
    description: 'Find the coverage moves that land big hits.',
    filter: (m)=>m>=2
  },
  notvery: {
    label: 'Not Very Effective',
    tagIcon: 'üõ°Ô∏è',
    prompt: 'Select the attack types that only deal √ó¬Ω damage.',
    description: 'Identify matchups that barely scratch this defender.',
    filter: (m)=>m===0.5
  },
  immune: {
    label: 'Immune',
    tagIcon: '‚õîÔ∏è',
    prompt: 'Select the attack types that do no damage (√ó0).',
    description: 'Catch every immunity before you lock in a move.',
    filter: (m)=>m===0
  },
  resist: {
    label: 'Resist',
    tagIcon: 'üîÅ',
    prompt: 'Select the attack types that deal only √ó¬º damage (double resist).',
    description: 'Memorize rare double resistances.',
    filter: (m)=>m===0.25,
    fallbackFilter: (m)=>m===0.5,
    fallbackPrompt: 'Select the attack types that deal √ó¬Ω damage. (No double resistances for this defender.)',
    fallbackNote: 'No double resistances found, so we are drilling regular resistances instead.'
  }
};

const intro = document.getElementById('intro');
const focusView = document.getElementById('focusView');
const quizView = document.getElementById('quizView');
const startBtn = document.getElementById('startBtn');
const backToIntro = document.getElementById('backToIntro');
const changeFocusBtn = document.getElementById('changeFocus');
const focusCards = document.querySelectorAll('.focus-card');
const focusTag = document.getElementById('focusTag');
const promptText = document.getElementById('promptText');
const focusNote = document.getElementById('focusNote');
const typeGrid = document.getElementById('typeGrid');
const pokeNameEl = document.getElementById('pokeName');
const pokeTypesEl = document.getElementById('pokeTypes');
const submitBtn = document.getElementById('submitBtn');
const nextBtn = document.getElementById('nextBtn');
const resultBox = document.getElementById('result');
const resultIcon = document.getElementById('resultIcon');
const resultHeading = document.getElementById('resultHeading');
const resultSummary = document.getElementById('resultSummary');
const scoreEl = document.getElementById('score');
const streakEl = document.getElementById('streak');
const bestEl = document.getElementById('best');

const VIEWS = { intro, focus: focusView, quiz: quizView };
let currentFocusKey = null;
let currentFocus = null;
let currentQuestion = null;
let score = 0, streak = 0, best = 0;
const selectedTypes = new Set();
const typeButtons = [];

function showView(name){
  Object.entries(VIEWS).forEach(([key,el])=>{
    if(el) el.classList.toggle('hidden', key!==name);
  });
}

function rand(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}

function chooseDefender(){
  const [name, types] = rand(ROSTER);
  return { name, types };
}

function mult(attack, defenders){
  const arr = defenders.filter(Boolean);
  let m = 1;
  for(const d of arr){
    const row = CHART[attack] || {};
    m *= (row[d] ?? 1);
  }
  return m;
}

function buildTypeButtons(){
  typeGrid.innerHTML = '';
  typeButtons.length = 0;
  TYPES.forEach(type=>{
    const btn = document.createElement('button');
    btn.className = `type-pill t-${type}`;
    btn.textContent = type;
    btn.dataset.type = type;
    btn.dataset.selected = 'false';
    btn.addEventListener('click', ()=> toggleType(type, btn));
    typeGrid.appendChild(btn);
    typeButtons.push(btn);
  });
}

function toggleType(type, btn){
  if(btn.disabled) return;
  if(selectedTypes.has(type)){
    selectedTypes.delete(type);
    btn.dataset.selected = 'false';
  } else {
    selectedTypes.add(type);
    btn.dataset.selected = 'true';
  }
}

function resetScoreboard(){
  score = 0;
  streak = 0;
  best = 0;
  updateScoreboard();
}

function updateScoreboard(){
  scoreEl.textContent = score;
  streakEl.textContent = streak;
  bestEl.textContent = best;
}

function setFocus(key){
  currentFocusKey = key;
  currentFocus = FOCUS[key];
  resetScoreboard();
  focusTag.dataset.focus = key;
  focusTag.innerHTML = `<span>${currentFocus.tagIcon}</span><span>${currentFocus.label} practice</span>`;
  showView('quiz');
  newQuestion();
}

function renderTypeChip(type){
  return `<span class="type-chip t-${type}">${type}</span>`;
}

function setDefenderUI(def){
  pokeNameEl.textContent = def.name;
  pokeTypesEl.innerHTML = def.types.map(renderTypeChip).join('');
}

function resetSelections(){
  selectedTypes.clear();
  typeButtons.forEach(btn=>{
    btn.dataset.selected = 'false';
    btn.dataset.state = '';
    btn.disabled = false;
  });
  resultBox.classList.add('hidden');
  resultBox.dataset.state = '';
  focusNote.classList.add('hidden');
  focusNote.textContent = '';
  submitBtn.disabled = false;
  nextBtn.disabled = true;
}

function computeMatches(def, filter){
  const correct = new Set();
  TYPES.forEach(type=>{
    const m = mult(type, def.types);
    if(filter(m)) correct.add(type);
  });
  return correct;
}

function pickQuestion(filter){
  if(!filter) return null;
  for(let attempts=0; attempts<160; attempts++){
    const def = chooseDefender();
    const correct = computeMatches(def, filter);
    if(correct.size){
      return { def, correct };
    }
  }
  return null;
}

function newQuestion(){
  if(!currentFocus) return;
  resetSelections();
  let q = pickQuestion(currentFocus.filter);
  let usedFallback = false;
  if(!q && currentFocus.fallbackFilter){
    q = pickQuestion(currentFocus.fallbackFilter);
    if(q){
      usedFallback = true;
    }
  }
  if(!q){
    currentQuestion = null;
    selectedTypes.clear();
    typeButtons.forEach(btn=>{
      btn.disabled = true;
      btn.dataset.selected = 'false';
      btn.dataset.state = '';
    });
    resultHeading.textContent = 'No matchups available';
    resultSummary.innerHTML = `<div class="result-line"><span>Heads up</span><div>We couldn't find any ${currentFocus.label.toLowerCase()} matchups in the current roster. Try a different focus or press Next to roll again.</div></div>`;
    resultBox.dataset.state = 'bad';
    resultBox.classList.remove('hidden');
    submitBtn.disabled = true;
    nextBtn.disabled = false;
    return;
  }
  currentQuestion = { ...q, usedFallback };
  setDefenderUI(q.def);
  const usingFallback = usedFallback && currentFocus.fallbackPrompt;
  promptText.textContent = usingFallback ? currentFocus.fallbackPrompt : currentFocus.prompt;
  if(usedFallback && currentFocus.fallbackNote){
    focusNote.textContent = currentFocus.fallbackNote;
    focusNote.classList.remove('hidden');
  }
}

function grade(){
  if(!currentQuestion) return;
  const correct = currentQuestion.correct;
  const selected = new Set(selectedTypes);
  if(correct.size === 0){
    return;
  }
  const missed = [...correct].filter(t=>!selected.has(t)).sort();
  const wrong = [...selected].filter(t=>!correct.has(t)).sort();
  const ok = missed.length === 0 && wrong.length === 0;

  typeButtons.forEach(btn=>{
    const t = btn.dataset.type;
    btn.disabled = true;
    if(correct.has(t) && selected.has(t)){
      btn.dataset.state = 'correct';
    } else if(correct.has(t) && !selected.has(t)){
      btn.dataset.state = 'missed';
    } else if(!correct.has(t) && selected.has(t)){
      btn.dataset.state = 'wrong';
    } else {
      btn.dataset.state = '';
    }
  });

  if(ok){
    score += 10;
    streak += 1;
    best = Math.max(best, streak);
  } else {
    score = Math.max(0, score - 3);
    streak = 0;
  }
  updateScoreboard();

  submitBtn.disabled = true;
  nextBtn.disabled = false;

  showResult(ok, correct, missed, wrong);
}

function showResult(ok, correct, missed, wrong){
  resultBox.dataset.state = ok ? 'good' : 'bad';
  resultIcon.textContent = ok ? '‚úì' : '‚úï';
  resultHeading.textContent = ok ? 'Great work!' : 'Keep practising';
  const parts = [];
  const sortedCorrect = [...correct].sort();
  parts.push(`<div class="result-line"><span>Correct answers</span><div class="chip-row">${sortedCorrect.map(renderTypeChip).join('')}</div></div>`);
  if(wrong.length){
    parts.push(`<div class="result-line"><span>Selected but incorrect</span><div class="chip-row">${wrong.map(renderTypeChip).join('')}</div></div>`);
  }
  if(missed.length){
    parts.push(`<div class="result-line"><span>You missed</span><div class="chip-row">${missed.map(renderTypeChip).join('')}</div></div>`);
  }
  if(ok){
    parts.push(`<div class="result-line"><span>Streak</span><div>${streak} correct in a row!</div></div>`);
  }
  resultSummary.innerHTML = parts.join('');
  resultBox.classList.remove('hidden');
}

startBtn.addEventListener('click', ()=> showView('focus'));
backToIntro.addEventListener('click', ()=>{
  showView('intro');
});
changeFocusBtn.addEventListener('click', ()=>{
  showView('focus');
  currentFocusKey = null;
  currentFocus = null;
});

focusCards.forEach(card=>{
  card.addEventListener('click', ()=>{
    const key = card.dataset.focus;
    if(FOCUS[key]){
      setFocus(key);
    }
  });
});

submitBtn.addEventListener('click', grade);
nextBtn.addEventListener('click', newQuestion);

window.addEventListener('keydown', (event)=>{
  if(quizView.classList.contains('hidden')) return;
  if(event.key === 'Enter'){
    event.preventDefault();
    if(!submitBtn.disabled) grade();
    else if(!nextBtn.disabled) newQuestion();
  }
  if(event.key && event.key.toLowerCase() === 'n' && !nextBtn.disabled){
    event.preventDefault();
    newQuestion();
  }
});

buildTypeButtons();
showView('intro');
</script>
</body>
</html>
