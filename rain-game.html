<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rain Verb Quiz – 雨が降る Practice</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 {
      text-align: left;
    }
    #quiz-container {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fafafa;
    }
    #question {
      font-size: 1.1rem;
      margin-bottom: 10px;
    }
    #hint {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 15px;
    }
    #hint-toggle {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    #hint-toggle[aria-pressed="true"] {
      border-color: #3366cc;
      color: #1f3b73;
      background: #eef3ff;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }
    button.option-btn {
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #ffffff;
      cursor: pointer;
      text-align: left;
      font-size: 1rem;
    }
    button.option-btn:hover {
      background: #f0f0ff;
    }
    button.option-btn.correct {
      border-color: #2e8b57;
      background: #e5ffef;
    }
    button.option-btn.incorrect {
      border-color: #cc0000;
      background: #ffecec;
    }
    #feedback {
      min-height: 1.3em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #explanation {
      font-size: 0.95rem;
      color: #444;
      margin-bottom: 15px;
    }
    #controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #next-btn {
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      background: #3366cc;
      color: #fff;
      cursor: pointer;
      font-size: 0.95rem;
    }
    #next-btn:hover {
      background: #274f9a;
    }
    #score {
      font-size: 0.95rem;
    }
    .jp {
      font-size: 1.1rem;
    }
    a {
      color: #3366cc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
      text-decoration: none;
      color: #333;
      font-weight: 600;
      cursor: pointer;
      font: inherit;
    }
    .back-link:hover {
      border-color: #3366cc;
      color: #1f3b73;
    }
  </style>
</head>
<body>
  <button class="back-link" type="button" data-back-button aria-label="Back">⟵ Back</button>
  <h1>Rain Verb Quiz – 雨が降る Practice</h1>
  <p>
    Practice saying things like “It rains”, “It’s raining”, and “It rained” in Japanese
    using <span class="jp">雨が降る</span>.  
    Pay attention to <strong>plain vs polite</strong> and <strong>tense</strong>.
  </p>
  <p>
    If you need help, open the
    <a href="rain-study-guide.html" target="_blank">Rain Study Guide</a>
    in another tab.
  </p>

  <div id="quiz-container">
    <div id="question"></div>
    <button id="hint-toggle" type="button" aria-pressed="false">Hints: Off</button>
    <div id="hint"></div>
    <div class="options" id="options"></div>
    <div id="feedback"></div>
    <div id="explanation"></div>
    <div id="controls">
      <div id="score">Score: 0 / 0</div>
      <button id="next-btn">Next Question</button>
    </div>
  </div>

  <script>
    const backButton = document.querySelector('[data-back-button]');
    if (backButton) {
      backButton.addEventListener('click', () => {
        if (window.history.length <= 1) {
          window.location.href = 'index.html';
        } else {
          window.history.back();
        }
      });
    }

    const questions = [
      {
        prompt: "It rains / It will rain. [plain]",
        hint: "Dictionary form of 雨が降る。",
        options: [
          "雨が降る。",
          "雨が降ります。",
          "雨が降っている。",
          "雨が降りました。"
        ],
        correctIndex: 0,
        explanation: "Plain non-past: 雨が降る（あめがふる） → It rains / it will rain."
      },
      {
        prompt: "It rains / It will rain. [polite]",
        hint: "Use ます form.",
        options: [
          "雨が降った。",
          "雨が降りません。",
          "雨が降ります。",
          "雨が降っている。"
        ],
        correctIndex: 2,
        explanation: "Polite non-past: 雨が降ります（あめがふります）."
      },
      {
        prompt: "It is raining (right now). [polite]",
        hint: "Use ている + ます.",
        options: [
          "雨が降ります。",
          "雨が降っている。",
          "雨が降りました。",
          "雨が降っています。"
        ],
        correctIndex: 3,
        explanation: "Polite progressive: 雨が降っています（あめがふっています） → It is raining."
      },
      {
        prompt: "It is raining (right now). [plain]",
        hint: "Use ている (no ます).",
        options: [
          "雨が降っている。",
          "雨が降る。",
          "雨が降っています。",
          "雨が降った。"
        ],
        correctIndex: 0,
        explanation: "Plain progressive: 雨が降っている（あめがふっている） → It is raining."
      },
      {
        prompt: "It rained. [plain]",
        hint: "Past plain form (〜た).",
        options: [
          "雨が降る。",
          "雨が降りました。",
          "雨が降った。",
          "雨が降りません。"
        ],
        correctIndex: 2,
        explanation: "Plain past: 雨が降った（あめがふった） → It rained."
      },
      {
        prompt: "It rained. [polite]",
        hint: "Use ました.",
        options: [
          "雨が降りました。",
          "雨が降る。",
          "雨が降っている。",
          "雨が降らない。"
        ],
        correctIndex: 0,
        explanation: "Polite past: 雨が降りました（あめがふりました） → It rained."
      },
      {
        prompt: "It doesn’t rain / won’t rain. [plain negative]",
        hint: "Negative of 降る is 降らない.",
        options: [
          "雨が降らない。",
          "雨が降りません。",
          "雨が降らなかった。",
          "雨が降ります。"
        ],
        correctIndex: 0,
        explanation: "Plain negative: 雨が降らない（あめがふらない）."
      },
      {
        prompt: "It doesn’t rain / won’t rain. [polite negative]",
        hint: "Use ません.",
        options: [
          "雨が降った。",
          "雨が降りません。",
          "雨が降らない。",
          "雨が降っていません。"
        ],
        correctIndex: 1,
        explanation: "Polite negative: 雨が降りません（あめがふりません）."
      },
      {
        prompt: "Yesterday, it rained. [polite]",
        hint: "Start with きのう and use polite past.",
        options: [
          "きのう、雨が降りました。",
          "きのう、雨が降っています。",
          "きのう、雨が降る。",
          "きのう、雨が降りません。"
        ],
        correctIndex: 0,
        explanation: "きのう、雨が降りました。→ Yesterday, it rained. (polite)"
      },
      {
        prompt: "It’s raining now, so I can’t play with my rats. [polite]",
        hint: "Use 今 and 〜ています, 〜ません.",
        options: [
          "今、雨が降っているから、ねずみと遊べません。",
          "今、雨が降るから、ねずみと遊べませんでした。",
          "今、雨が降りましたから、ねずみと遊びません。",
          "今、雨が降りますから、ねずみと遊べない。"
        ],
        correctIndex: 0,
        explanation: "今、雨が降っているから、ねずみと遊べません。→ It’s raining now, so I can’t play with my rats."
      }
    ];

    let currentIndex = 0;
    let score = 0;
    let answered = 0;

    const questionEl = document.getElementById("question");
    const hintEl = document.getElementById("hint");
    const optionsEl = document.getElementById("options");
    const feedbackEl = document.getElementById("feedback");
    const explanationEl = document.getElementById("explanation");
    const scoreEl = document.getElementById("score");
    const nextBtn = document.getElementById("next-btn");
    const hintToggleBtn = document.getElementById("hint-toggle");
    const storedShowHints = localStorage.getItem("rainGameShowHints");
    let showHints = storedShowHints ? storedShowHints === "true" : false;

    function updateHintToggle() {
      hintToggleBtn.textContent = showHints ? "Hints: On" : "Hints: Off";
      hintToggleBtn.setAttribute("aria-pressed", showHints ? "true" : "false");
    }

    function updateHintDisplay() {
      const q = questions[currentIndex];
      if (showHints) {
        hintEl.textContent = "Hint: " + q.hint;
        hintEl.style.display = "";
      } else {
        hintEl.textContent = "";
        hintEl.style.display = "none";
      }
    }

    function loadQuestion() {
      const q = questions[currentIndex];
      questionEl.textContent = "Q" + (currentIndex + 1) + ": " + q.prompt;
      updateHintDisplay();

      optionsEl.innerHTML = "";
      feedbackEl.textContent = "";
      explanationEl.textContent = "";

      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.className = "option-btn";
        btn.addEventListener("click", () => selectOption(i));
        optionsEl.appendChild(btn);
      });
    }

    function selectOption(selectedIndex) {
      // prevent double answering
      if (feedbackEl.textContent !== "") return;

      const q = questions[currentIndex];
      const buttons = document.querySelectorAll(".option-btn");

      buttons.forEach((btn, i) => {
        if (i === q.correctIndex) {
          btn.classList.add("correct");
        }
        if (i === selectedIndex && i !== q.correctIndex) {
          btn.classList.add("incorrect");
        }
        btn.disabled = true;
      });

      answered++;
      if (selectedIndex === q.correctIndex) {
        score++;
        feedbackEl.textContent = "✅ Correct!";
      } else {
        feedbackEl.textContent = "❌ Incorrect.";
      }
      explanationEl.textContent = q.explanation;
      updateScore();
    }

    function updateScore() {
      scoreEl.textContent = "Score: " + score + " / " + answered;
    }

    nextBtn.addEventListener("click", () => {
      currentIndex++;
      if (currentIndex >= questions.length) {
        currentIndex = 0;
      }
      loadQuestion();
    });

    hintToggleBtn.addEventListener("click", () => {
      showHints = !showHints;
      localStorage.setItem("rainGameShowHints", showHints);
      updateHintToggle();
      updateHintDisplay();
    });

    // init
    updateHintToggle();
    loadQuestion();
    updateScore();
  </script>
</body>
</html>
