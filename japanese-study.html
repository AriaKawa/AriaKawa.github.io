<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Japanese Study Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #13060d;
      --panel: #2b0d18;
      --accent: #d9557f;
      --good: #22c55e;
      --bad: #ef4444;
      --text: #e9d8e8;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #3a0f20, var(--bg) 65%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .panel {
      background: rgba(43, 13, 24, 0.82);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      max-width: 1100px;
      width: 100%;
      padding: 20px 20px 26px;
      backdrop-filter: blur(12px);
      box-shadow: 0 20px 45px rgba(0,0,0,0.25);
    }
    .scene {
      display: none;
    }
    .scene.active {
      display: block;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }
    h1 {
      font-size: 1.2rem;
      margin: 0;
    }
    .topic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
      margin-top: 20px;
    }
    .topic-card {
      background: rgba(43, 13, 24, 0.65);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
    }
    .topic-card h2 {
      margin: 4px 0 4px;
      font-size: 1.05rem;
    }
    .topic-card p {
      margin: 0;
      color: rgba(233, 216, 232, 0.85);
      line-height: 1.5;
    }
    .eyebrow {
      font-size: 0.75rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: rgba(233, 216, 232, 0.7);
      margin: 0;
    }
    .topic-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .chip {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: var(--text);
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
      transition: 0.15s ease;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .chip[disabled], .chip[aria-disabled="true"] {
      opacity: 0.4;
      cursor: not-allowed;
      color: rgba(233, 216, 232, 0.7);
      border-color: rgba(255, 255, 255, 0.12);
    }
    .chip.primary {
      background: var(--accent);
      color: #2b0d18;
      border-color: transparent;
    }
    .chip:hover {
      border-color: rgba(217, 85, 127, 0.6);
      color: var(--accent);
    }
    .chip.primary:hover {
      background: #e06b93;
      color: #2b0d18;
    }
    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    button {
      background: var(--accent);
      border: none;
      color: #2b0d18;
      font-weight: 600;
      padding: 8px 16px;
      border-radius: 999px;
      cursor: pointer;
      transition: 0.15s ease;
    }
    button:hover {
      background: #e06b93;
    }
    .ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.16);
      color: var(--text);
      padding: 6px 14px;
      border-radius: 999px;
      cursor: pointer;
      transition: 0.15s ease;
      align-self: flex-start;
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }
    .ghost:hover {
      color: var(--accent);
      border-color: rgba(217, 85, 127, 0.65);
    }
    .timer, .status {
      background: rgba(43, 13, 24, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 999px;
      padding: 5px 14px;
      font-size: 0.8rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(250px, 1fr));
      gap: 16px;
    }
    .match-area {
      position: relative;
      margin-top: 10px;
    }
    .match-grid {
      position: relative;
      z-index: 1;
    }
    .connection-layer {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }
    .connection-line {
      stroke: rgba(255, 255, 255, 0.35);
      stroke-width: 3;
      stroke-linecap: round;
      filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.15));
    }
    .connection-line.active {
      stroke: rgba(217, 85, 127, 0.7);
      stroke-dasharray: 6 4;
    }
    .mode-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
      margin-top: 8px;
    }
    .mode-card {
      background: rgba(43, 13, 24, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .mode-card h2 {
      margin: 2px 0 4px;
      font-size: 1rem;
    }
    .guide-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    .guide-item {
      background: rgba(43, 13, 24, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06);
    }
    .guide-item .hiragana {
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 0.04em;
    }
    .guide-item .romaji {
      font-size: 0.95rem;
      opacity: 0.8;
    }
    .guide-item .en {
      font-size: 0.85rem;
      line-height: 1.3;
      color: rgba(233, 216, 232, 0.9);
    }
    .hint-text {
      color: rgba(233, 216, 232, 0.75);
    }
    .section {
      background: rgba(43, 13, 24, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      padding: 16px;
      margin-top: 16px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06);
    }
    .section h2 {
      margin: 0 0 10px;
      font-size: 1rem;
    }
    .section p {
      margin: 0 0 10px;
      line-height: 1.5;
      color: rgba(233, 216, 232, 0.9);
    }
    .section strong {
      color: var(--accent);
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .cheat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
    }
    .cheat-item {
      background: rgba(43, 13, 24, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 12px;
    }
    .cheat-item h3 {
      margin: 0 0 6px;
      font-size: 0.95rem;
      color: var(--accent);
    }
    .cheat-item ul {
      padding-left: 18px;
      margin: 0;
      line-height: 1.4;
    }
    .cheat-item li {
      margin-bottom: 4px;
    }
    .contrast-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
    }
    .contrast-card {
      background: rgba(43, 13, 24, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 12px;
      line-height: 1.4;
    }
    .contrast-card h3 {
      margin: 0 0 6px;
      font-size: 0.95rem;
      color: var(--accent);
    }
    .col {
      background: rgba(43, 13, 24, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      padding: 12px;
      min-height: 360px;
    }
    .col-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.7;
      margin-bottom: 10px;
    }
    .item {
      background: rgba(43, 13, 24, 0.35);
      border: 1px solid transparent;
      border-radius: 10px;
      padding: 7px 10px 8px;
      margin-bottom: 6px;
      cursor: pointer;
      transition: 0.1s ease;
      font-size: 0.9rem;
    }
    .item:hover {
      background: rgba(217, 85, 127, 0.14);
      border-color: rgba(255, 255, 255, 0.2);
    }
    .item.selected {
      border-color: var(--accent);
      background: rgba(217, 85, 127, 0.26);
    }
    .item.correct {
      background: rgba(34, 197, 94, 0.18);
      border-color: rgba(34, 197, 94, 1);
      color: #ecfdf3;
      cursor: default;
    }
    .item.disabled {
      pointer-events: none;
      opacity: 0.6;
    }
    .footer-text {
      margin-top: 15px;
      font-size: 0.7rem;
      opacity: 0.4;
      text-align: right;
    }
    @media (max-width: 720px) {
      body {
        padding: 16px;
      }
      .grid {
        grid-template-columns: 1fr;
      }
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      .topic-grid, .mode-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <section id="menuScene" class="scene panel active">
    <button class="ghost" id="menuBackBtn">âŸµ Back to Home</button>
    <h1>Japanese Study Hub</h1>
    <p>Pick a topic to explore. Each card keeps the study guide and the game together.</p>
    <div class="topic-grid">
      <div class="topic-card">
        <div>
          <p class="eyebrow">Core set</p>
          <h2>Verbs Hub</h2>
          <p>Match verbs, browse the guide, or jump into the ã™ã‚‹ pack.</p>
        </div>
        <div class="topic-actions">
          <button id="verbsCategoryBtn" class="chip primary">Open verb hub</button>
          <button id="suruGuideBtn" class="chip">ã™ã‚‹ capsules</button>
        </div>
      </div>

      <div class="topic-card">
        <div>
          <p class="eyebrow">Weather</p>
          <h2>Rain verbs</h2>
          <p>Study the list or try the themed matching game.</p>
        </div>
        <div class="topic-actions">
          <a class="chip" href="rain-guide.html">Study guide</a>
          <a class="chip primary" href="rain-game.html">Play game</a>
        </div>
      </div>

      <div class="topic-card">
        <div>
          <p class="eyebrow">Weekly rhythm</p>
          <h2>Days of the week</h2>
          <p>Keep practice and study side-by-side for quick refreshers.</p>
        </div>
        <div class="topic-actions">
          <a class="chip" href="days-study-guide.html">Study guide</a>
          <a class="chip primary" href="days-game.html">Play game</a>
        </div>
      </div>

      <div class="topic-card">
        <div>
          <p class="eyebrow">Counting</p>
          <h2>Time &amp; Year</h2>
          <p>Practice dates and times with the mini drill game.</p>
        </div>
        <div class="topic-actions">
          <a class="chip primary" href="time-year-game.html">Play game</a>
        </div>
      </div>

      <div class="topic-card">
        <div>
          <p class="eyebrow">Vocabulary</p>
          <h2>Nouns</h2>
          <p>Flashcards and drills are on the way.</p>
        </div>
        <div class="topic-actions">
          <button id="nounsCategoryBtn" class="chip" disabled aria-disabled="true">Coming soon</button>
        </div>
      </div>

      <div class="topic-card">
        <div>
          <p class="eyebrow">Particles</p>
          <h2>Grammar bits</h2>
          <p>Fill-in-the-blank practice will land here.</p>
        </div>
        <div class="topic-actions">
          <button id="particlesCategoryBtn" class="chip" disabled aria-disabled="true">Coming soon</button>
        </div>
      </div>
    </div>
  </section>

  <section id="verbsScene" class="scene panel">
    <button class="ghost" id="verbsBackBtn">âŸµ Back to Topics</button>
    <div class="header">
      <h1>Verb Practice Zone</h1>
      <p>Match, review, or speedrun through common verbs.</p>
    </div>
    <div class="mode-grid">
      <div class="mode-card">
        <div>
          <p class="eyebrow">Core verbs</p>
          <h2>Main set</h2>
          <p>Jump between the matching game and the study guide.</p>
        </div>
        <div class="topic-actions">
          <button id="verbsGameBtn" class="chip primary">Match game</button>
          <button id="verbsGuideBtn" class="chip">Study guide</button>
        </div>
      </div>

      <div class="mode-card">
        <div>
          <p class="eyebrow">ã™ã‚‹ pack</p>
          <h2>JLPT N5 â†’ N4</h2>
          <p>Review the capsules or drill forms with the trainer.</p>
        </div>
        <div class="topic-actions">
          <button id="suruGuideBtnSecondary" class="chip">Study capsules</button>
          <button id="suruGameBtn" class="chip primary">Play trainer</button>
        </div>
      </div>

      <div class="mode-card">
        <div>
          <p class="eyebrow">Extra set</p>
          <h2>Time + Year</h2>
          <p>Keep the time practice close to the core verbs.</p>
        </div>
        <div class="topic-actions">
          <button id="timeYearBtn" class="chip primary">Time &amp; year game</button>
        </div>
      </div>
    </div>
  </section>

  <section id="gameScene" class="scene panel">
    <button class="ghost" id="backToMenu">âŸµ Back</button>
    <div class="header">
      <h1>Verb Match â€” N5/N4-ish</h1>
      <div class="controls">
        <button id="startBtn">Start</button>
        <div class="timer" id="timer">Time: 0.00s</div>
        <div class="status" id="status">Click "Start" for 10 pairs, then drag to match.</div>
      </div>
    </div>
    <div id="matchArea" class="match-area">
      <svg id="connectionCanvas" class="connection-layer"></svg>
      <div class="grid match-grid">
        <div class="col" id="leftCol">
          <div class="col-title">Romaji (readings)</div>
          <!-- verbs here -->
        </div>
        <div class="col" id="rightCol">
          <div class="col-title">Meaning (English)</div>
          <!-- meanings here -->
        </div>
      </div>
    </div>
    <div class="footer-text">
      Tip: try to beat your own time ğŸ‘Š
    </div>
  </section>

  <section id="guideScene" class="scene panel">
    <button class="ghost" id="guideBackBtn">âŸµ Back to Verb Modes</button>
    <div class="header" id="guide">
      <h1>Verb Study Guide</h1>
      <p>Review hiragana, romaji, and meanings before diving into a game.</p>
    </div>
    <div id="guideList" class="guide-list"></div>
  </section>

  <section id="suruScene" class="scene panel">
    <button class="ghost" id="suruBackBtn">âŸµ Back to Verb Modes</button>
    <div class="header">
      <h1>ã™ã‚‹ Verb Capsules (JLPT N5â†’N4)</h1>
      <p>Quick-hit ã™ã‚‹ verbs sorted by level with notes on how they show up.</p>
    </div>
    <div class="section">
      <h2>How noun + <strong>ã™ã‚‹</strong> works</h2>
      <p><strong>Pattern:</strong> Noun (action idea) ï¼‹ ã™ã‚‹. The noun already contains the action meaning, and ã™ã‚‹ turns it into a verb. You can drop ã™ã‚‹ in dictionaries and see the noun on its own (ã¹ã‚“ãã‚‡ã†, ã‚Œã‚“ã—ã‚…ã†, ã‚ˆã‚„ã).</p>
      <div class="info-grid">
        <div class="guide-item">
          <div class="hiragana">N5 idea</div>
          <div class="en">ã—ã‚…ãã ã„ã™ã‚‹, ã•ã‚“ã½ã™ã‚‹, ã§ã‚“ã‚ã™ã‚‹ â†’ add ã™ã‚‹ to â€œhomework,â€ â€œwalk,â€ â€œphoneâ€ to talk about doing them.</div>
        </div>
        <div class="guide-item">
          <div class="hiragana">Why nouns become verbs</div>
          <div class="en">Talking about an action (study, plan, review) uses a noun plus ã™ã‚‹. You can still attach particles to the noun: æ—¥æœ¬èªã‚’ã¹ã‚“ãã‚‡ã†ã™ã‚‹, å‹ã ã¡ã«ã§ã‚“ã‚ã™ã‚‹.</div>
        </div>
        <div class="guide-item">
          <div class="hiragana">Particle quick check</div>
          <div class="en">ã‚’ marks the thing you act on (ãƒ†ã‚¹ãƒˆã‚’ãµãã—ã‚…ã†ã™ã‚‹). ã« marks the target person (å…ˆç”Ÿã«è³ªå•ã‚’ã‚Œã‚“ã—ã‚…ã†ã™ã‚‹). ã§ marks the place you do it (å®¶ã§ãã†ã˜ã™ã‚‹).</div>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>Core ã™ã‚‹ verbs (N5 â†’ early N4)</h2>
      <div id="suruList" class="guide-list"></div>
    </div>

    <div class="section">
      <h2>ã™ã‚‹ conjugation cheat sheet</h2>
      <p>Keep sentences short and clear. All examples use the verbs above.</p>
      <div class="cheat-grid">
        <div class="cheat-item">
          <h3>ã™ã‚‹ (dictionary)</h3>
          <ul>
            <li>æ¯æ—¥æ—¥æœ¬èªã‚’<strong>ã¹ã‚“ãã‚‡ã†ã™ã‚‹</strong>.</li>
            <li>æ—¥æ›œæ—¥ã¯å…¬åœ’ã‚’<strong>ã•ã‚“ã½ã™ã‚‹</strong>.</li>
          </ul>
        </div>
        <div class="cheat-item">
          <h3>ã—ã¾ã™ (polite)</h3>
          <ul>
            <li>ã“ã‚Œã‹ã‚‰éƒ¨å±‹ã‚’<strong>ãã†ã˜ã—ã¾ã™</strong>.</li>
            <li>ã‚ã¨ã§å‹ã ã¡ã«<strong>ã§ã‚“ã‚ã—ã¾ã™</strong>.</li>
          </ul>
        </div>
        <div class="cheat-item">
          <h3>ã—ãŸ (plain past)</h3>
          <ul>
            <li>ãã®ã†ãƒ›ãƒ†ãƒ«ã‚’<strong>ã‚ˆã‚„ãã—ãŸ</strong>.</li>
            <li>ãƒ†ã‚¹ãƒˆã§å°‘ã—<strong>ã—ã£ã±ã„ã—ãŸ</strong>.</li>
          </ul>
        </div>
        <div class="cheat-item">
          <h3>ã—ã¾ã—ãŸ (polite past)</h3>
          <ul>
            <li>å…ˆç”Ÿã«è³ªå•ã®<strong>ã‚Œã‚“ã—ã‚…ã†ã‚’ã—ã¾ã—ãŸ</strong>.</li>
            <li>æˆæ¥­ã®ã‚ã¨ã€ã—ã£ã‹ã‚Š<strong>ãµãã—ã‚…ã†ã—ã¾ã—ãŸ</strong>.</li>
          </ul>
        </div>
        <div class="cheat-item">
          <h3>ã—ã¦ (ã¦-form)</h3>
          <ul>
            <li>å®¿é¡Œã‚’<strong>ã—ã¦</strong>ã€ã‚²ãƒ¼ãƒ ã‚’ã—ã¾ã™.</li>
            <li>æœã€å®¶ã‚’<strong>ãã†ã˜ã—ã¦</strong>ã‹ã‚‰å‡ºã‹ã‘ã¾ã™.</li>
          </ul>
        </div>
        <div class="cheat-item">
          <h3>ã—ã¦ã„ã¾ã™ / ã—ã¦ã„ã‚‹ (progressive / current state)</h3>
          <ul>
            <li>ä»Šã€å›³æ›¸é¤¨ã§<strong>ã¹ã‚“ãã‚‡ã†ã—ã¦ã„ã¾ã™</strong>.</li>
            <li>å§‰ã¯ãƒ”ã‚¢ãƒã‚’<strong>ã‚Œã‚“ã—ã‚…ã†ã—ã¦ã„ã‚‹</strong>ã¨ã“ã‚ã§ã™.</li>
          </ul>
        </div>
        <div class="cheat-item">
          <h3>ã—ã¦ãã ã•ã„ (please do)</h3>
          <ul>
            <li>ãƒ¬ãƒãƒ¼ãƒˆã‚’æ—©ã‚ã«<strong>ã‘ã„ã‹ãã—ã¦ãã ã•ã„</strong>.</li>
            <li>ãƒ†ã‚¹ãƒˆå‰ã«ã‚‚ã†ä¸€åº¦<strong>ãµãã—ã‚…ã†ã—ã¦ãã ã•ã„</strong>.</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="section">
      <h2>ã—ã¦ vs ã—ã¦ã„ã¾ã™ â€” quick contrasts</h2>
      <p><strong>ã—ã¦</strong> connects actions or asks for help. <strong>ã—ã¦ã„ã¾ã™ / ã—ã¦ã„ã‚‹</strong> shows an ongoing action or current state.</p>
      <div class="contrast-grid">
        <div class="contrast-card">
          <h3>A ã‚’ B ã—ã¾ã™</h3>
          <div>æ¯æ™©ã—ã‚…ãã ã„ã‚’<strong>ã—ã¾ã™</strong>. (routine)</div>
          <div>ä»Šã—ã‚…ãã ã„ã‚’<strong>ã—ã¦ã„ã¾ã™</strong>. (right now)</div>
        </div>
        <div class="contrast-card">
          <h3>äººã«é›»è©±ã—ã¦</h3>
          <div>å‹ã ã¡ã«<strong>ã§ã‚“ã‚ã—ã¦</strong>ã€éŠã³ã¾ã™. (call then do next action)</div>
          <div>ä»Šã€æ¯ã«<strong>ã§ã‚“ã‚ã—ã¦ã„ã¾ã™</strong>. (currently on a call)</div>
        </div>
        <div class="contrast-card">
          <h3>ãã†ã˜ã™ã‚‹: ã§ / ã‚’</h3>
          <div>ãƒªãƒ“ãƒ³ã‚°ã§<strong>ãã†ã˜ã—ã¦</strong>ã‹ã‚‰ã€å°æ‰€ã‚‚ã—ã¾ã™. (place = ã§)</div>
          <div>ãƒªãƒ“ãƒ³ã‚°ã‚’<strong>ãã†ã˜ã—ã¦ã„ã¾ã™</strong>. (object = ã‚’, action in progress)</div>
        </div>
        <div class="contrast-card">
          <h3>è¨ˆç”»ã™ã‚‹ (plan)</h3>
          <div>æ—…è¡Œã‚’<strong>ã‘ã„ã‹ãã—ã¦</strong>ã€å‹ã ã¡ã«è¦‹ã›ã¾ã™. (sequence)</div>
          <div>ä»Šã€æ—…è¡Œã‚’<strong>ã‘ã„ã‹ãã—ã¦ã„ã¾ã™</strong>. (still working on it)</div>
        </div>
        <div class="contrast-card">
          <h3>ã‚Œã‚“ã—ã‚…ã†ã™ã‚‹ (practice)</h3>
          <div>æ¯æœæ—¥æœ¬èªã‚’<strong>ã‚Œã‚“ã—ã‚…ã†ã—ã¦</strong>ã‹ã‚‰å‡ºç¤¾ã—ã¾ã™. (do before another action)</div>
          <div>æœã‹ã‚‰ãšã£ã¨æ—¥æœ¬èªã‚’<strong>ã‚Œã‚“ã—ã‚…ã†ã—ã¦ã„ã¾ã™</strong>. (continuous)</div>
        </div>
      </div>
    </div>
  </section>

  <section id="suruGameScene" class="scene panel">
    <button class="ghost" id="suruGameBackBtn">âŸµ Back to Verb Modes</button>
    <div class="header">
      <h1>ã™ã‚‹ Verb Trainer</h1>
      <p>Mix-and-match drills using the same N5â†’N4 ã™ã‚‹ verbs.</p>
    </div>

    <div class="controls" style="margin-bottom:12px; gap:8px; flex-wrap:wrap;">
      <button class="ghost" data-suru-mode="fill" aria-label="Fill-in-the-blank">Fill-in Blank</button>
      <button class="ghost" data-suru-mode="forms" aria-label="Multiple choice forms">Correct Form</button>
      <button class="ghost" data-suru-mode="build" aria-label="Sentence building">Sentence Builder</button>
      <button class="ghost" data-suru-mode="speed" aria-label="Speed round">Speed Round</button>
      <button class="ghost" id="suruHintToggle" aria-pressed="true">Hints: On</button>
      <div class="status" id="suruProgress">Score: 0/0 â€¢ Mode: Fill-in</div>
    </div>

    <div id="suruPrompt" style="background: rgba(43, 13, 24, 0.55); border: 1px solid rgba(255,255,255,0.12); padding: 14px; border-radius: 12px; min-height: 120px; margin-bottom: 14px; line-height: 1.4;"></div>

    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-start;">
      <input id="suruInput" type="text" placeholder="Type your answer here" style="flex:1; min-width:200px; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.18); background: rgba(43,13,24,0.4); color: var(--text);" />
      <button id="suruSubmitBtn">Check</button>
      <button class="ghost" id="suruSkipBtn">Skip</button>
    </div>

    <div id="suruChoices" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap:10px; margin-top:12px;"></div>

    <div id="suruWordBank" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;"></div>

    <div class="status" id="suruFeedback" style="margin-top:12px;">Pick a mode to start.</div>
  </section>

  <section id="nounsScene" class="scene panel">
    <button class="ghost" id="nounsBackBtn">âŸµ Back to Topics</button>
    <div class="header">
      <h1>Noun Practice (Coming Soon)</h1>
      <p>Flashcards, categories, and matching challenges for nouns are on the way.</p>
    </div>
    <p>Bookmark this pageâ€”noun drills will land here once they're ready.</p>
  </section>

  <section id="particlesScene" class="scene panel">
    <button class="ghost" id="particlesBackBtn">âŸµ Back to Topics</button>
    <div class="header">
      <h1>Particles &amp; Grammar (Coming Soon)</h1>
      <p>Expect fill-in-the-blank practice, quick quizzes, and mnemonics.</p>
    </div>
    <p>Check back later for interactive particle practice modes.</p>
  </section>

  <script>
    // JLPT N5 + N4 verbs (user provided clean lists)
    const VERBS = [
      { id: 1, jp: "ã‚ã†", romaji: "au", en: "to meet" },
      { id: 2, jp: "ã‚ãã¶", romaji: "asobu", en: "to play" },
      { id: 3, jp: "ã‚ã‚‹", romaji: "aru", en: "to exist (non-living)" },
      { id: 4, jp: "ã„ã†", romaji: "iu", en: "to say" },
      { id: 5, jp: "ã„ã", romaji: "iku", en: "to go" },
      { id: 6, jp: "ã†ãŸã†", romaji: "utau", en: "to sing" },
      { id: 7, jp: "ãŠã‚ˆã", romaji: "oyogu", en: "to swim" },
      { id: 8, jp: "ãŠã‚ã‚‹", romaji: "owaru", en: "to finish" },
      { id: 9, jp: "ã‹ã", romaji: "kaku", en: "to write" },
      { id: 10, jp: "ã‹ã™", romaji: "kasu", en: "to lend" },
      { id: 11, jp: "ãã", romaji: "kiku", en: "to listen / to ask" },
      { id: 12, jp: "ãã‚‹", romaji: "kiru", en: "to cut" },
      { id: 13, jp: "ã™ã‚ã‚‹", romaji: "suwaru", en: "to sit" },
      { id: 14, jp: "ãŸã¤", romaji: "tatsu", en: "to stand" },
      { id: 15, jp: "ã¤ã‹ã†", romaji: "tsukau", en: "to use" },
      { id: 16, jp: "ã¤ãã‚‹", romaji: "tsukuru", en: "to make" },
      { id: 17, jp: "ã¨ã¶", romaji: "tobu", en: "to fly / to jump" },
      { id: 18, jp: "ã®ã‚‹", romaji: "noru", en: "to ride" },
      { id: 19, jp: "ã¯ã—ã‚‹", romaji: "hashiru", en: "to run" },
      { id: 20, jp: "ã¯ãªã™", romaji: "hanasu", en: "to speak" },
      { id: 21, jp: "ã¾ã¤", romaji: "matsu", en: "to wait" },
      { id: 22, jp: "ã‚ˆã‚€", romaji: "yomu", en: "to read" },
      { id: 23, jp: "ã‚ã‹ã‚‹", romaji: "wakaru", en: "to understand" },
      { id: 24, jp: "ãŠãã‚‹", romaji: "okiru", en: "to wake up" },
      { id: 25, jp: "ãŠã—ãˆã‚‹", romaji: "oshieru", en: "to teach" },
      { id: 26, jp: "ãŸã¹ã‚‹", romaji: "taberu", en: "to eat" },
      { id: 27, jp: "ã¿ã›ã‚‹", romaji: "miseru", en: "to show" },
      { id: 28, jp: "ã¿ã‚‹", romaji: "miru", en: "to see" },
      { id: 29, jp: "ã­ã‚‹", romaji: "neru", en: "to sleep" },
      { id: 30, jp: "ã™ã‚‹", romaji: "suru", en: "to do" },
      { id: 31, jp: "ã¹ã‚“ãã‚‡ã†ã™ã‚‹", romaji: "benkyou suru", en: "to study" },
      { id: 32, jp: "ãã†ã˜ã™ã‚‹", romaji: "souji suru", en: "to clean" },
      { id: 33, jp: "ã‚Šã‚‡ã“ã†ã™ã‚‹", romaji: "ryokou suru", en: "to travel" },
      { id: 34, jp: "ã§ã‚“ã‚ã™ã‚‹", romaji: "denwa suru", en: "to call" },
      { id: 35, jp: "ãŠã¼ãˆã‚‹", romaji: "oboeru", en: "to memorize" },
      { id: 36, jp: "ã†ã‘ã‚‹", romaji: "ukeru", en: "to take (exam)" },
      { id: 37, jp: "ã¦ã¤ã ã†", romaji: "tetsudau", en: "to help" },
      { id: 38, jp: "ã¯ã˜ã‚ã‚‹", romaji: "hajimeru", en: "to begin" },
      { id: 39, jp: "ãªãŠã™", romaji: "naosu", en: "to fix" },
      { id: 40, jp: "ã¤ã¥ã‘ã‚‹", romaji: "tsuzukeru", en: "to continue" },
      { id: 41, jp: "ãã‚ã‚‹", romaji: "kimeru", en: "to decide" },
      { id: 42, jp: "ã‚ã¤ã¾ã‚‹", romaji: "atsumaru", en: "to gather (people)" },
      { id: 43, jp: "ã‚ã¤ã‚ã‚‹", romaji: "atsumeru", en: "to collect (things)" },
      { id: 44, jp: "ã„ã®ã‚‹", romaji: "inoru", en: "to pray" },
      { id: 45, jp: "ã†ã”ã", romaji: "ugoku", en: "to move" },
      { id: 46, jp: "ãˆã‚‰ã¶", romaji: "erabu", en: "to choose" },
      { id: 47, jp: "ãŠãã‚‹", romaji: "okuru", en: "to send" },
      { id: 48, jp: "ãŠã©ã‚‹", romaji: "odoru", en: "to dance" },
      { id: 49, jp: "ãŠã‚‚ã„ã ã™", romaji: "omoidasu", en: "to remember (recall)" },
      { id: 50, jp: "ãŠã‚Œã‚‹", romaji: "oreru", en: "to break (intransitive)" },
      { id: 51, jp: "ãŠã“ã™", romaji: "okosu", en: "to wake someone" },
      { id: 52, jp: "ã‹ãˆã‚‹", romaji: "kaeru", en: "to change (transitive)" },
      { id: 53, jp: "ã‹ã‚ã‚‹", romaji: "kawaru", en: "to change (intransitive)" },
      { id: 54, jp: "ã‹ã‚ˆã†", romaji: "kayou", en: "to commute" },
      { id: 55, jp: "ã“ã‚ã™", romaji: "kowasu", en: "to break (transitive)" },
      { id: 56, jp: "ã“ã‚ã‚Œã‚‹", romaji: "kowareru", en: "to break (intransitive)" },
      { id: 57, jp: "ã•ãŒã™", romaji: "sagasu", en: "to search" },
      { id: 58, jp: "ã•ã‚ã‚‹", romaji: "sawaru", en: "to touch" },
      { id: 59, jp: "ã—ã¾ã‚‹", romaji: "shimaru", en: "to close (intransitive)" },
      { id: 60, jp: "ã—ã‚ã‚‹", romaji: "shimeru", en: "to close (transitive)" },
      { id: 61, jp: "ã—ã‚‰ã¹ã‚‹", romaji: "shiraberu", en: "to investigate / to check" },
      { id: 62, jp: "ã™ãã‚‹", romaji: "sugiru", en: "to pass / to exceed" },
      { id: 63, jp: "ãŸã‚Šã‚‹", romaji: "tariru", en: "to be enough" },
      { id: 64, jp: "ã¤ã¥ã", romaji: "tsuzuku", en: "to continue (intransitive)" },
      { id: 65, jp: "ã¤ãŸãˆã‚‹", romaji: "tsutaeru", en: "to convey / to communicate" },
      { id: 66, jp: "ã¤ã‚Œã¦ã„ã", romaji: "tsureteiku", en: "to take someone along" },
      { id: 67, jp: "ã¨ã¾ã‚‹", romaji: "tomaru", en: "to stop / to stay (hotel)" },
      { id: 68, jp: "ã¨ã‚ã‚‹", romaji: "tomeru", en: "to stop (transitive)" },
      { id: 69, jp: "ã¨ã‚Šã‹ãˆã‚‹", romaji: "torikaeru", en: "to exchange" },
      { id: 70, jp: "ãªãŠã‚‹", romaji: "naoru", en: "to get better / to be fixed" },
      { id: 71, jp: "ã²ã‚‰ã", romaji: "hiraku", en: "to open" },
      { id: 72, jp: "ã¿ã¤ã‹ã‚‹", romaji: "mitsukaru", en: "to be found" },
      { id: 73, jp: "ã¿ã¤ã‘ã‚‹", romaji: "mitsukeru", en: "to find" },
      { id: 74, jp: "ã‚‚ã©ã‚‹", romaji: "modoru", en: "to return" },
      { id: 75, jp: "ã‚„ãã«ãŸã¤", romaji: "yaku ni tatsu", en: "to be useful" },
      { id: 76, jp: "ã‚„ã‚€", romaji: "yamu", en: "to stop (rain)" },
      { id: 77, jp: "ã‚ˆã”ã‚Œã‚‹", romaji: "yogoreru", en: "to become dirty" },
      { id: 78, jp: "ã‚ˆã‚„ãã™ã‚‹", romaji: "yoyaku suru", en: "to reserve" },
      { id: 79, jp: "ã‚Œã‚“ã—ã‚…ã†ã™ã‚‹", romaji: "renshuu suru", en: "to practice" },
      { id: 80, jp: "ã—ã£ã±ã„ã™ã‚‹", romaji: "shippai suru", en: "to fail" },
      { id: 81, jp: "ã‚ã‚„ã¾ã‚‹", romaji: "ayamaru", en: "to apologize" }
    ];

    const leftCol = document.getElementById("leftCol");
    const rightCol = document.getElementById("rightCol");
    const matchArea = document.getElementById("matchArea");
    const connectionCanvas = document.getElementById("connectionCanvas");
    const startBtn = document.getElementById("startBtn");
    const timerEl = document.getElementById("timer");
    const statusEl = document.getElementById("status");
    const backToMenuBtn = document.getElementById("backToMenu");
    const verbsGameBtn = document.getElementById("verbsGameBtn");
    const menuBackBtn = document.getElementById("menuBackBtn");
    const verbsGuideBtn = document.getElementById("verbsGuideBtn");
    const timeYearBtn = document.getElementById("timeYearBtn");
    const verbsCategoryBtn = document.getElementById("verbsCategoryBtn");
    const nounsCategoryBtn = document.getElementById("nounsCategoryBtn");
    const particlesCategoryBtn = document.getElementById("particlesCategoryBtn");
    const verbsBackBtn = document.getElementById("verbsBackBtn");
    const nounsBackBtn = document.getElementById("nounsBackBtn");
    const particlesBackBtn = document.getElementById("particlesBackBtn");
    const guideList = document.getElementById("guideList");
    const guideBackBtn = document.getElementById("guideBackBtn");
    const suruGuideBtn = document.getElementById("suruGuideBtn");
    const suruGuideBtnSecondary = document.getElementById("suruGuideBtnSecondary");
    const suruList = document.getElementById("suruList");
    const suruBackBtn = document.getElementById("suruBackBtn");
    const suruGameBtn = document.getElementById("suruGameBtn");
    const suruGameScene = document.getElementById("suruGameScene");
    const suruGameBackBtn = document.getElementById("suruGameBackBtn");
    const suruProgress = document.getElementById("suruProgress");
    const suruPrompt = document.getElementById("suruPrompt");
    const suruInput = document.getElementById("suruInput");
    const suruSubmitBtn = document.getElementById("suruSubmitBtn");
    const suruSkipBtn = document.getElementById("suruSkipBtn");
    const suruChoices = document.getElementById("suruChoices");
    const suruWordBank = document.getElementById("suruWordBank");
    const suruFeedback = document.getElementById("suruFeedback");
    const suruHintToggle = document.getElementById("suruHintToggle");

    let selectedLeft = null;
    let selectedRight = null;
    let startTime = null;
    let timerInterval = null;
    let matches = 0;
    let currentPool = [];
    let connectionLines = [];
    let activeLine = null;
    const MATCH_COUNT = 10;
    let gameActive = false;
    let currentScene = "menuScene";

    const SCENE_HASH_MAP = {
      menuScene: "#menu",
      verbsScene: "#verbs",
      gameScene: "#verbs-game",
      guideScene: "#verbs-guide",
      suruScene: "#suru",
      suruGameScene: "#suru-trainer",
      nounsScene: "#nouns",
      particlesScene: "#particles"
    };

    const SURU_GUIDE = [
      { level: "N5", jp: "ã¹ã‚“ãã‚‡ã†ã™ã‚‹", romaji: "benkyou suru", en: "to study", note: "Classic N5 combo verb; pairs with ã‚’ + subject (æ—¥æœ¬èªã‚’ã¹ã‚“ãã‚‡ã†ã™ã‚‹)." },
      { level: "N5", jp: "ã•ã‚“ã½ã™ã‚‹", romaji: "sanpo suru", en: "to take a walk", note: "Often used with ã«/ã¸ to mark the destination for strolling." },
      { level: "N5", jp: "ã§ã‚“ã‚ã™ã‚‹", romaji: "denwa suru", en: "to call (on the phone)", note: "Use ã« to mark who youâ€™re calling: å‹ã ã¡ã«ã§ã‚“ã‚ã™ã‚‹." },
      { level: "N5", jp: "ãã†ã˜ã™ã‚‹", romaji: "souji suru", en: "to clean", note: "Can take a place with ã‚’ or ã§ (éƒ¨å±‹ã‚’ãã†ã˜ã™ã‚‹ / éƒ¨å±‹ã§ãã†ã˜ã™ã‚‹)." },
      { level: "N5", jp: "ã—ã‚…ãã ã„ã™ã‚‹", romaji: "shukudai suru", en: "to do homework", note: "Follows the noun directlyâ€”no extra particle needed in casual speech." },
      { level: "N4", jp: "ã‚ˆã‚„ãã™ã‚‹", romaji: "yoyaku suru", en: "to reserve; to book", note: "Common for appointments and tickets; ã‚’ marks what youâ€™re booking." },
      { level: "N4", jp: "ã‚Œã‚“ã—ã‚…ã†ã™ã‚‹", romaji: "renshuu suru", en: "to practice", note: "Attach the thing you practice with ã‚’, e.g., ãƒ”ã‚¢ãƒã‚’ã‚Œã‚“ã—ã‚…ã†ã™ã‚‹." },
      { level: "N4", jp: "ã—ã£ã±ã„ã™ã‚‹", romaji: "shippai suru", en: "to fail; to make a mistake", note: "Pairs with ã§ or ã« to mark what failed: ãƒ†ã‚¹ãƒˆã§ã—ã£ã±ã„ã—ãŸ." },
      { level: "N4", jp: "ã‘ã„ã‹ãã™ã‚‹", romaji: "keikaku suru", en: "to plan", note: "Pairs with ã‚’ for whatâ€™s being planned; also appears as è¨ˆç”»ã‚’ç«‹ã¦ã‚‹." },
      { level: "N4", jp: "ãµãã—ã‚…ã†ã™ã‚‹", romaji: "fukushuu suru", en: "to review; to revise", note: "Textbook favorite for talking about reviewing lessons." }
    ];

    const SURU_FORMS = [
      { jp: "ã¹ã‚“ãã‚‡ã†ã™ã‚‹", en: "to study", masu: "ã¹ã‚“ãã‚‡ã†ã—ã¾ã™", masuPast: "ã¹ã‚“ãã‚‡ã†ã—ã¾ã—ãŸ", masuNegative: "ã¹ã‚“ãã‚‡ã†ã—ã¾ã›ã‚“", te: "ã¹ã‚“ãã‚‡ã†ã—ã¦", nai: "ã¹ã‚“ãã‚‡ã†ã—ãªã„", past: "ã¹ã‚“ãã‚‡ã†ã—ãŸ", pastNegative: "ã¹ã‚“ãã‚‡ã†ã—ãªã‹ã£ãŸ", volitional: "ã¹ã‚“ãã‚‡ã†ã—ã‚ˆã†" },
      { jp: "ã•ã‚“ã½ã™ã‚‹", en: "to take a walk", masu: "ã•ã‚“ã½ã—ã¾ã™", masuPast: "ã•ã‚“ã½ã—ã¾ã—ãŸ", masuNegative: "ã•ã‚“ã½ã—ã¾ã›ã‚“", te: "ã•ã‚“ã½ã—ã¦", nai: "ã•ã‚“ã½ã—ãªã„", past: "ã•ã‚“ã½ã—ãŸ", pastNegative: "ã•ã‚“ã½ã—ãªã‹ã£ãŸ", volitional: "ã•ã‚“ã½ã—ã‚ˆã†" },
      { jp: "ã§ã‚“ã‚ã™ã‚‹", en: "to call", masu: "ã§ã‚“ã‚ã—ã¾ã™", masuPast: "ã§ã‚“ã‚ã—ã¾ã—ãŸ", masuNegative: "ã§ã‚“ã‚ã—ã¾ã›ã‚“", te: "ã§ã‚“ã‚ã—ã¦", nai: "ã§ã‚“ã‚ã—ãªã„", past: "ã§ã‚“ã‚ã—ãŸ", pastNegative: "ã§ã‚“ã‚ã—ãªã‹ã£ãŸ", volitional: "ã§ã‚“ã‚ã—ã‚ˆã†" },
      { jp: "ãã†ã˜ã™ã‚‹", en: "to clean", masu: "ãã†ã˜ã—ã¾ã™", masuPast: "ãã†ã˜ã—ã¾ã—ãŸ", masuNegative: "ãã†ã˜ã—ã¾ã›ã‚“", te: "ãã†ã˜ã—ã¦", nai: "ãã†ã˜ã—ãªã„", past: "ãã†ã˜ã—ãŸ", pastNegative: "ãã†ã˜ã—ãªã‹ã£ãŸ", volitional: "ãã†ã˜ã—ã‚ˆã†" },
      { jp: "ã—ã‚…ãã ã„ã™ã‚‹", en: "to do homework", masu: "ã—ã‚…ãã ã„ã—ã¾ã™", masuPast: "ã—ã‚…ãã ã„ã—ã¾ã—ãŸ", masuNegative: "ã—ã‚…ãã ã„ã—ã¾ã›ã‚“", te: "ã—ã‚…ãã ã„ã—ã¦", nai: "ã—ã‚…ãã ã„ã—ãªã„", past: "ã—ã‚…ãã ã„ã—ãŸ", pastNegative: "ã—ã‚…ãã ã„ã—ãªã‹ã£ãŸ", volitional: "ã—ã‚…ãã ã„ã—ã‚ˆã†" },
      { jp: "ã‚ˆã‚„ãã™ã‚‹", en: "to reserve", masu: "ã‚ˆã‚„ãã—ã¾ã™", masuPast: "ã‚ˆã‚„ãã—ã¾ã—ãŸ", masuNegative: "ã‚ˆã‚„ãã—ã¾ã›ã‚“", te: "ã‚ˆã‚„ãã—ã¦", nai: "ã‚ˆã‚„ãã—ãªã„", past: "ã‚ˆã‚„ãã—ãŸ", pastNegative: "ã‚ˆã‚„ãã—ãªã‹ã£ãŸ", volitional: "ã‚ˆã‚„ãã—ã‚ˆã†" },
      { jp: "ã‚Œã‚“ã—ã‚…ã†ã™ã‚‹", en: "to practice", masu: "ã‚Œã‚“ã—ã‚…ã†ã—ã¾ã™", masuPast: "ã‚Œã‚“ã—ã‚…ã†ã—ã¾ã—ãŸ", masuNegative: "ã‚Œã‚“ã—ã‚…ã†ã—ã¾ã›ã‚“", te: "ã‚Œã‚“ã—ã‚…ã†ã—ã¦", nai: "ã‚Œã‚“ã—ã‚…ã†ã—ãªã„", past: "ã‚Œã‚“ã—ã‚…ã†ã—ãŸ", pastNegative: "ã‚Œã‚“ã—ã‚…ã†ã—ãªã‹ã£ãŸ", volitional: "ã‚Œã‚“ã—ã‚…ã†ã—ã‚ˆã†" },
      { jp: "ã—ã£ã±ã„ã™ã‚‹", en: "to fail", masu: "ã—ã£ã±ã„ã—ã¾ã™", masuPast: "ã—ã£ã±ã„ã—ã¾ã—ãŸ", masuNegative: "ã—ã£ã±ã„ã—ã¾ã›ã‚“", te: "ã—ã£ã±ã„ã—ã¦", nai: "ã—ã£ã±ã„ã—ãªã„", past: "ã—ã£ã±ã„ã—ãŸ", pastNegative: "ã—ã£ã±ã„ã—ãªã‹ã£ãŸ", volitional: "ã—ã£ã±ã„ã—ã‚ˆã†" },
      { jp: "ã‘ã„ã‹ãã™ã‚‹", en: "to plan", masu: "ã‘ã„ã‹ãã—ã¾ã™", masuPast: "ã‘ã„ã‹ãã—ã¾ã—ãŸ", masuNegative: "ã‘ã„ã‹ãã—ã¾ã›ã‚“", te: "ã‘ã„ã‹ãã—ã¦", nai: "ã‘ã„ã‹ãã—ãªã„", past: "ã‘ã„ã‹ãã—ãŸ", pastNegative: "ã‘ã„ã‹ãã—ãªã‹ã£ãŸ", volitional: "ã‘ã„ã‹ãã—ã‚ˆã†" },
      { jp: "ãµãã—ã‚…ã†ã™ã‚‹", en: "to review", masu: "ãµãã—ã‚…ã†ã—ã¾ã™", masuPast: "ãµãã—ã‚…ã†ã—ã¾ã—ãŸ", masuNegative: "ãµãã—ã‚…ã†ã—ã¾ã›ã‚“", te: "ãµãã—ã‚…ã†ã—ã¦", nai: "ãµãã—ã‚…ã†ã—ãªã„", past: "ãµãã—ã‚…ã†ã—ãŸ", pastNegative: "ãµãã—ã‚…ã†ã—ãªã‹ã£ãŸ", volitional: "ãµãã—ã‚…ã†ã—ã‚ˆã†" }
    ];
    const SURU_FILL_BLANKS = [
      { sentence: "ã¾ã„ã«ã¡æ—¥æœ¬èªã‚’ï¼¿ï¼¿ï¼¿ï¼¿ã€‚", answer: "ã¹ã‚“ãã‚‡ã†ã—ã¾ã™", hint: "polite present" },
      { sentence: "ãã®ã†å‹ã ã¡ã«ï¼¿ï¼¿ï¼¿ï¼¿ã€‚", answer: "ã§ã‚“ã‚ã—ã¾ã—ãŸ", hint: "past tense" },
      { sentence: "ã¸ã‚„ã‚’ãã‚Œã„ã«ã™ã‚‹ãŸã‚ã«ï¼¿ï¼¿ï¼¿ï¼¿ã€‚", answer: "ãã†ã˜ã—ã¾ã™", hint: "polite" },
      { sentence: "ãƒ†ã‚¹ãƒˆã®ã¾ãˆã«ã‚‚ã†ä¸€åº¦ï¼¿ï¼¿ï¼¿ï¼¿ã€‚", answer: "ãµãã—ã‚…ã†ã—ã¾ã™", hint: "review" },
      { sentence: "ã‚ã—ãŸã“ã†ãˆã‚“ã‚’ï¼¿ï¼¿ï¼¿ï¼¿ã¤ã‚‚ã‚Šã§ã™ã€‚", answer: "ã•ã‚“ã½ã™ã‚‹", hint: "plain" },
      { sentence: "ãƒã‚±ãƒƒãƒˆã‚’ï¼¿ï¼¿ï¼¿ï¼¿ã®ã§ã€ã„ã£ã—ã‚‡ã«è¡Œãã¾ã—ã‚‡ã†ã€‚", answer: "ã‚ˆã‚„ãã—ãŸ", hint: "plain past" },
      { sentence: "æ¯é€±ãƒ”ã‚¢ãƒã‚’ï¼¿ï¼¿ï¼¿ï¼¿ã€‚", answer: "ã‚Œã‚“ã—ã‚…ã†ã—ã¾ã™", hint: "practice" },
      { sentence: "ã—ã£ã±ã„ã—ãªã„ã‚ˆã†ã«ã€è¨ˆç”»ã‚’ã‚ˆãï¼¿ï¼¿ï¼¿ï¼¿ã€‚", answer: "ã‘ã„ã‹ãã—ã¾ã™", hint: "plan it" }
    ];

    const SURU_SENTENCE_BANK = [
      { english: "I will call my friend tonight.", pieces: ["ã‚ãŸã—ã¯", "ã‚ˆã‚‹", "å‹ã ã¡ã«", "ã§ã‚“ã‚ã—ã¾ã™"], answer: "ã‚ãŸã—ã¯ ã‚ˆã‚‹ å‹ã ã¡ã« ã§ã‚“ã‚ã—ã¾ã™" },
      { english: "Let's clean the room tomorrow.", pieces: ["ã‚ã—ãŸ", "éƒ¨å±‹ã‚’", "ãã†ã˜ã—ã¾ã—ã‚‡ã†"], answer: "ã‚ã—ãŸ éƒ¨å±‹ã‚’ ãã†ã˜ã—ã¾ã—ã‚‡ã†" },
      { english: "I plan to review the lesson.", pieces: ["ãƒ¬ãƒƒã‚¹ãƒ³ã‚’", "ãµãã—ã‚…ã†ã—ã¾ã™", "ã‚ˆã¦ã„ã§ã™"], answer: "ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ ãµãã—ã‚…ã†ã—ã¾ã™ ã‚ˆã¦ã„ã§ã™" },
      { english: "We practiced Japanese yesterday.", pieces: ["ãã®ã†", "æ—¥æœ¬èªã‚’", "ã‚Œã‚“ã—ã‚…ã†ã—ã¾ã—ãŸ"], answer: "ãã®ã† æ—¥æœ¬èªã‚’ ã‚Œã‚“ã—ã‚…ã†ã—ã¾ã—ãŸ" }
    ];

    let suruMode = "fill";
    let suruScore = { correct: 0, total: 0 };
    let suruCurrent = null;
    let speedTimer = null;
    let speedTimeLeft = 30;
    const SURU_HINT_STORAGE_KEY = "suruShowHints";
    const storedSuruHints = localStorage.getItem(SURU_HINT_STORAGE_KEY);
    let showHints = storedSuruHints ? storedSuruHints === "true" : false;

    const FORM_LABELS = { masu: "ã¾ã™", masuPast: "ã¾ã—ãŸ", masuNegative: "ã¾ã›ã‚“", te: "ã¦", nai: "ãªã„", past: "past", pastNegative: "ãªã‹ã£ãŸ", volitional: "volitional" };

    function updateSuruProgress(extra = "") {
      const modeNames = { fill: "Fill-in", forms: "Correct Form", build: "Sentence Builder", speed: "Speed" };
      const bonus = extra ? ` â€¢ ${extra}` : "";
      if (suruProgress) {
        suruProgress.textContent = `Score: ${suruScore.correct}/${suruScore.total} â€¢ Mode: ${modeNames[suruMode]}${bonus}`;
      }
    }

    function resetSuruUI() {
      suruInput.value = "";
      suruChoices.innerHTML = "";
      suruWordBank.innerHTML = "";
      suruFeedback.textContent = "Pick a mode to start.";
    }

    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function normalizeAnswer(str) {
      return str.replace(/\s+/g, " ").trim();
    }

    function renderFillPrompt() {
      if (!suruCurrent) return;
      const hintText = showHints ? `<br><small class="hint-text">Hint: ${suruCurrent.hint}</small>` : "";
      suruPrompt.innerHTML = `<strong>Fill the blank:</strong> ${suruCurrent.sentence}${hintText}`;
    }

    function updateHintToggle() {
      if (!suruHintToggle) return;
      suruHintToggle.textContent = `Hints: ${showHints ? "On" : "Off"}`;
      suruHintToggle.setAttribute("aria-pressed", showHints ? "true" : "false");
    }

    function newFillQuestion() {
      suruCurrent = pickRandom(SURU_FILL_BLANKS);
      renderFillPrompt();
      suruInput.placeholder = "type the missing phrase";
      suruInput.disabled = false;
      suruSubmitBtn.disabled = false;
      suruChoices.innerHTML = "";
      suruWordBank.innerHTML = "";
    }

    function buildChoices(formKey) {
      const pool = shuffle(SURU_FORMS).map(v => v[formKey]);
      const options = [suruCurrent.correct];
      for (const cand of pool) {
        if (options.length >= 4) break;
        if (!options.includes(cand)) options.push(cand);
      }
      return shuffle(options);
    }

    function newFormQuestion(isSpeed = false) {
      const verb = pickRandom(SURU_FORMS);
      const formKey = pickRandom(["masu", "masuPast", "masuNegative", "te", "nai", "past", "pastNegative", "volitional"]);
      const promptLabel = FORM_LABELS[formKey];
      const correct = verb[formKey];
      suruCurrent = { type: isSpeed ? "speed" : "forms", correct, prompt: `${verb.jp} (${verb.en}) â†’ ${promptLabel} form`, formKey };
      suruPrompt.innerHTML = `<strong>Pick the ${promptLabel} form.</strong><br>${verb.jp} (${verb.en})`;
      suruInput.disabled = true;
      suruSubmitBtn.disabled = true;
      suruChoices.innerHTML = "";
      const opts = buildChoices(formKey);
      opts.forEach(choice => {
        const btn = document.createElement("button");
        btn.className = "ghost";
        btn.textContent = choice;
        btn.addEventListener("click", () => handleSuruChoice(choice));
        suruChoices.appendChild(btn);
      });
    }

    function newBuildQuestion() {
      suruCurrent = pickRandom(SURU_SENTENCE_BANK);
      suruPrompt.innerHTML = `<strong>Build this sentence:</strong> ${suruCurrent.english}<br><small>Tap the pieces or type.</small>`;
      suruInput.placeholder = "click pieces below or type your version";
      suruInput.disabled = false;
      suruSubmitBtn.disabled = false;
      suruChoices.innerHTML = "";
      suruWordBank.innerHTML = "";
      shuffle(suruCurrent.pieces.slice()).forEach(piece => {
        const chip = document.createElement("button");
        chip.className = "ghost";
        chip.textContent = piece;
        chip.addEventListener("click", () => {
          const existing = normalizeAnswer(suruInput.value);
          suruInput.value = existing ? `${existing} ${piece}` : piece;
        });
        suruWordBank.appendChild(chip);
      });
    }

    function newSpeedQuestion() {
      newFormQuestion(true);
    }

    function changeSuruMode(mode) {
      suruMode = mode;
      suruInput.value = "";
      suruFeedback.textContent = "";
      if (speedTimer) {
        clearInterval(speedTimer);
        speedTimer = null;
      }
      if (mode !== "speed") {
        speedTimeLeft = 30;
      }
      if (mode === "fill") newFillQuestion();
      if (mode === "forms") newFormQuestion();
      if (mode === "build") newBuildQuestion();
      if (mode === "speed") startSpeedRound();
      updateSuruProgress();
    }

    function handleSuruChoice(choice) {
      if (!suruCurrent) return;
      const correct = choice === suruCurrent.correct;
      suruScore.total += 1;
      if (correct) suruScore.correct += 1;
      suruFeedback.textContent = correct ? "âœ… Correct!" : `âœï¸ Answer: ${suruCurrent.correct}`;
      if (suruMode === "forms") {
        newFormQuestion();
      } else if (suruMode === "speed") {
        newSpeedQuestion();
      }
      updateSuruProgress(suruMode === "speed" ? `Time: ${speedTimeLeft}s` : "");
    }

    function checkSuruInput() {
      if (!suruCurrent) return;
      let correct = false;
      const userAnswer = normalizeAnswer(suruInput.value);
      if (suruMode === "fill") {
        correct = userAnswer === normalizeAnswer(suruCurrent.answer);
        suruFeedback.textContent = correct ? "âœ… Nice!" : `âœï¸ ${suruCurrent.answer}`;
        newFillQuestion();
      } else if (suruMode === "build") {
        correct = normalizeAnswer(suruCurrent.answer) === userAnswer;
        suruFeedback.textContent = correct ? "âœ… Sounds natural." : `âœï¸ Example: ${suruCurrent.answer}`;
        newBuildQuestion();
      }
      suruScore.total += 1;
      if (correct) suruScore.correct += 1;
      updateSuruProgress();
    }

    function skipSuruQuestion() {
      if (suruMode === "fill") newFillQuestion();
      if (suruMode === "forms") newFormQuestion();
      if (suruMode === "build") newBuildQuestion();
      if (suruMode === "speed") newSpeedQuestion();
      suruFeedback.textContent = "Skipped. New prompt ready.";
      updateSuruProgress();
    }

    function startSpeedRound() {
      speedTimeLeft = 30;
      suruFeedback.textContent = "Go fast! Pick the right form.";
      suruInput.disabled = true;
      suruSubmitBtn.disabled = true;
      newSpeedQuestion();
      updateSuruProgress(`Time: ${speedTimeLeft}s`);
      speedTimer = setInterval(() => {
        speedTimeLeft -= 1;
        if (speedTimeLeft <= 0) {
          clearInterval(speedTimer);
          speedTimer = null;
          suruFeedback.textContent = `â±ï¸ Time! Final score: ${suruScore.correct}/${suruScore.total}`;
          suruChoices.innerHTML = "";
          suruPrompt.textContent = "Speed round finished.";
          updateSuruProgress("Done");
          return;
        }
        updateSuruProgress(`Time: ${speedTimeLeft}s`);
      }, 1000);
    }

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function syncCanvasSize() {
      if (!matchArea || !connectionCanvas) return;
      const rect = matchArea.getBoundingClientRect();
      connectionCanvas.setAttribute("width", rect.width);
      connectionCanvas.setAttribute("height", rect.height);
      connectionCanvas.setAttribute("viewBox", `0 0 ${rect.width} ${rect.height}`);
      updateAllConnectionLines();
    }

    function getCenterPoint(el) {
      if (!el || !matchArea) return { x: 0, y: 0 };
      const areaRect = matchArea.getBoundingClientRect();
      const rect = el.getBoundingClientRect();
      return {
        x: rect.left - areaRect.left + rect.width / 2,
        y: rect.top - areaRect.top + rect.height / 2
      };
    }

    function drawConnectionLine(leftEl, rightEl, lineEl) {
      const line = lineEl ?? document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.classList.add("connection-line");
      const start = getCenterPoint(leftEl);
      const end = getCenterPoint(rightEl);
      line.setAttribute("x1", start.x);
      line.setAttribute("y1", start.y);
      line.setAttribute("x2", end.x);
      line.setAttribute("y2", end.y);
      if (!lineEl) connectionCanvas.appendChild(line);
      return line;
    }

    function updateAllConnectionLines() {
      connectionLines.forEach(conn => drawConnectionLine(conn.left, conn.right, conn.line));
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
    }

    function startTimer() {
      startTime = performance.now();
      timerInterval = setInterval(() => {
        const now = performance.now();
        const diff = (now - startTime) / 1000;
        timerEl.textContent = `Time: ${diff.toFixed(2)}s`;
      }, 50);
    }

    function startLineDrag(evt, originEl) {
      if (!gameActive || !matchArea || originEl.classList.contains("correct")) return;
      clearSelections();
      originEl.classList.add("selected");
      selectedLeft = originEl;
      syncCanvasSize();

      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.classList.add("connection-line", "active");
      connectionCanvas.appendChild(line);
      activeLine = line;
      updateActiveLine(evt.clientX, evt.clientY);
      window.addEventListener("pointermove", handlePointerMove);
      window.addEventListener("pointerup", handlePointerUp);
      evt.preventDefault();
    }

    function updateActiveLine(clientX, clientY) {
      if (!activeLine || !selectedLeft || !matchArea) return;
      const start = getCenterPoint(selectedLeft);
      const areaRect = matchArea.getBoundingClientRect();
      activeLine.setAttribute("x1", start.x);
      activeLine.setAttribute("y1", start.y);
      activeLine.setAttribute("x2", clientX - areaRect.left);
      activeLine.setAttribute("y2", clientY - areaRect.top);
    }

    function handlePointerMove(evt) {
      updateActiveLine(evt.clientX, evt.clientY);
    }

    function handlePointerUp(evt) {
      window.removeEventListener("pointermove", handlePointerMove);
      window.removeEventListener("pointerup", handlePointerUp);

      const target = document.elementFromPoint(evt.clientX, evt.clientY);
      const item = target?.closest ? target.closest(".item") : target;
      const inRightCol = item?.closest ? item.closest("#rightCol") : null;

      if (item && inRightCol) {
        selectRight(item);
      } else if (activeLine) {
        connectionCanvas.removeChild(activeLine);
        activeLine = null;
        clearSelections();
      }

      if (activeLine) {
        connectionCanvas.removeChild(activeLine);
        activeLine = null;
      }
    }

    function buildBoard() {
      leftCol.querySelectorAll(".item").forEach(el => el.remove());
      rightCol.querySelectorAll(".item").forEach(el => el.remove());
      connectionLines = [];
      activeLine = null;
      connectionCanvas.innerHTML = "";
      syncCanvasSize();

      currentPool = shuffle(VERBS).slice(0, MATCH_COUNT);
      const left = shuffle(currentPool);
      const right = shuffle(currentPool);

      left.forEach(v => {
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = v.romaji;
        div.dataset.id = v.id;
        div.addEventListener("click", () => selectLeft(div));
        div.addEventListener("pointerdown", evt => startLineDrag(evt, div));
        leftCol.appendChild(div);
      });

      right.forEach(v => {
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = v.en;
        div.dataset.id = v.id;
        div.addEventListener("click", () => selectRight(div));
        rightCol.appendChild(div);
      });
    }

    function resetGameBoard() {
      buildBoard();
      stopTimer();
      matches = 0;
      gameActive = false;
      clearSelections();
      timerEl.textContent = "Time: 0.00s";
      statusEl.textContent = "Click \"Start\" for 10 new pairs.";
    }

    function clearSelections() {
      leftCol.querySelectorAll(".item.selected").forEach(el => el.classList.remove("selected"));
      rightCol.querySelectorAll(".item.selected").forEach(el => el.classList.remove("selected"));
      selectedLeft = null;
      selectedRight = null;
      if (activeLine) {
        connectionCanvas.removeChild(activeLine);
        activeLine = null;
      }
    }

    function selectLeft(el) {
      if (!gameActive) return;
      if (el.classList.contains("correct")) return;
      leftCol.querySelectorAll(".item").forEach(i => i.classList.remove("selected"));
      el.classList.add("selected");
      selectedLeft = el;
      checkMatch();
    }

    function selectRight(el) {
      if (!gameActive) return;
      if (el.classList.contains("correct")) return;
      rightCol.querySelectorAll(".item").forEach(i => i.classList.remove("selected"));
      el.classList.add("selected");
      selectedRight = el;
      checkMatch();
    }

    function checkMatch() {
      if (selectedLeft && selectedRight) {
        const idL = selectedLeft.dataset.id;
        const idR = selectedRight.dataset.id;
        if (idL === idR) {
          // correct
          selectedLeft.classList.add("correct");
          selectedRight.classList.add("correct");
          selectedLeft.classList.remove("selected");
          selectedRight.classList.remove("selected");
          const line = drawConnectionLine(selectedLeft, selectedRight);
          connectionLines.push({ left: selectedLeft, right: selectedRight, line });
          if (activeLine) {
            connectionCanvas.removeChild(activeLine);
            activeLine = null;
          }
          matches++;
          statusEl.textContent = `Nice! ${matches}/${currentPool.length} matched.`;
          clearSelections();
          if (matches === currentPool.length) {
            gameActive = false;
            stopTimer();
            const finalTime = timerEl.textContent.replace("Time: ", "");
            statusEl.textContent = `Finished! Your time: ${finalTime}`;
          }
        } else {
          // wrong
          statusEl.textContent = "Not a match.";
          // brief flash red?
          const l = selectedLeft;
          const r = selectedRight;
          l.classList.add("bad");
          r.classList.add("bad");
          setTimeout(() => {
            l.classList.remove("selected", "bad");
            r.classList.remove("selected", "bad");
            selectedLeft = null;
            selectedRight = null;
            if (activeLine) {
              connectionCanvas.removeChild(activeLine);
              activeLine = null;
            }
          }, 350);
        }
      }
    }

    function renderGuide() {
      if (!guideList) return;
      guideList.innerHTML = "";
      VERBS.forEach(verb => {
        const card = document.createElement("div");
        card.className = "guide-item";

        const hiragana = document.createElement("div");
        hiragana.className = "hiragana";
        hiragana.textContent = verb.jp;

        const romaji = document.createElement("div");
        romaji.className = "romaji";
        romaji.textContent = verb.romaji;

        const english = document.createElement("div");
        english.className = "en";
        english.textContent = verb.en;

        card.append(hiragana, romaji, english);
        guideList.appendChild(card);
      });
    }

    function renderSuruGuide() {
      if (!suruList) return;
      suruList.innerHTML = "";

      SURU_GUIDE.forEach(entry => {
        const card = document.createElement("div");
        card.className = "guide-item";

        const headerRow = document.createElement("div");
        headerRow.style.display = "flex";
        headerRow.style.justifyContent = "space-between";
        headerRow.style.width = "100%";

        const hiragana = document.createElement("div");
        hiragana.className = "hiragana";
        hiragana.textContent = entry.jp;

        const tag = document.createElement("span");
        tag.textContent = entry.level;
        tag.style.fontSize = "0.75rem";
        tag.style.background = "rgba(217, 85, 127, 0.2)";
        tag.style.border = "1px solid rgba(217, 85, 127, 0.55)";
        tag.style.padding = "2px 8px";
        tag.style.borderRadius = "999px";
        tag.style.color = "var(--text)";

        headerRow.append(hiragana, tag);

        const romaji = document.createElement("div");
        romaji.className = "romaji";
        romaji.textContent = entry.romaji;

        const english = document.createElement("div");
        english.className = "en";
        english.textContent = entry.en;

        const note = document.createElement("div");
        note.className = "en";
        note.style.fontSize = "0.82rem";
        note.style.opacity = "0.8";
        note.textContent = entry.note;

        card.append(headerRow, romaji, english, note);
        suruList.appendChild(card);
      });
    }

    function showScene(id) {
      const target = document.getElementById(id);
      if (!target || id === currentScene) return;
      if (currentScene === "gameScene" && id !== "gameScene") {
        resetGameBoard();
      }
      if (currentScene === "suruGameScene" && id !== "suruGameScene") {
        if (speedTimer) clearInterval(speedTimer);
        speedTimer = null;
        suruFeedback.textContent = "Pick a mode to start.";
        suruChoices.innerHTML = "";
        suruPrompt.textContent = "";
      }
      const current = document.getElementById(currentScene);
      current?.classList.remove("active");
      target.classList.add("active");
      currentScene = id;
    }

    function sceneFromHash(hashValue) {
      if (!hashValue) return "menuScene";
      const normalizedHash = hashValue.startsWith("#") ? hashValue : `#${hashValue}`;
      const entry = Object.entries(SCENE_HASH_MAP).find(([, hash]) => hash === normalizedHash);
      return entry ? entry[0] : "menuScene";
    }

    function sceneFromLocation() {
      const fromHash = sceneFromHash(window.location.hash);
      if (fromHash !== "menuScene") {
        return fromHash;
      }
      const params = new URLSearchParams(window.location.search);
      const sceneParam = params.get("scene");
      return sceneFromHash(sceneParam ?? "");
    }

    function syncLocationHash(sceneId) {
      const desiredHash = SCENE_HASH_MAP[sceneId] ?? "";
      if (desiredHash) {
        if (window.location.hash !== desiredHash) {
          window.location.hash = desiredHash;
        }
      } else if (window.location.hash) {
        history.replaceState(null, "", window.location.pathname + window.location.search);
      }
    }

    function applyInitialScene() {
      const initialScene = sceneFromLocation();
      if (initialScene === "menuScene") return;
      document.getElementById("menuScene")?.classList.remove("active");
      currentScene = "menuScene";
      showScene(initialScene);
    }

    function handleHashChange() {
      const targetScene = sceneFromHash(window.location.hash);
      if (targetScene === currentScene) return;
      showScene(targetScene);
    }

    startBtn.addEventListener("click", () => {
      buildBoard();
      stopTimer();
      matches = 0;
      gameActive = true;
      statusEl.textContent = "Draw lines between romaji and meaning!";
      timerEl.textContent = "Time: 0.00s";
      startTimer();
    });

    backToMenuBtn.addEventListener("click", () => {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        showScene("verbsScene");
        syncLocationHash("verbsScene");
      }
    });

    verbsGameBtn.addEventListener("click", () => {
      showScene("gameScene");
      syncLocationHash("gameScene");
    });

    menuBackBtn.addEventListener("click", () => {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = "index.html";
      }
    });

    verbsGuideBtn.addEventListener("click", () => {
      showScene("guideScene");
      syncLocationHash("guideScene");
    });

    function goToSuruGuide() {
      showScene("suruScene");
      syncLocationHash("suruScene");
    }

    suruGuideBtn?.addEventListener("click", goToSuruGuide);
    suruGuideBtnSecondary?.addEventListener("click", goToSuruGuide);
    suruGameBtn?.addEventListener("click", () => {
      showScene("suruGameScene");
      syncLocationHash("suruGameScene");
      changeSuruMode("fill");
      updateSuruProgress();
    });

    timeYearBtn.addEventListener("click", () => {
      window.location.href = "time-year-game.html";
    });

    window.addEventListener("resize", syncCanvasSize);

    guideBackBtn.addEventListener("click", () => {
      showScene("verbsScene");
      syncLocationHash("verbsScene");
    });

    suruBackBtn.addEventListener("click", () => {
      showScene("verbsScene");
      syncLocationHash("verbsScene");
    });

    suruGameBackBtn.addEventListener("click", () => {
      showScene("verbsScene");
      syncLocationHash("verbsScene");
    });

    verbsCategoryBtn.addEventListener("click", () => {
      showScene("verbsScene");
      syncLocationHash("verbsScene");
    });

    nounsCategoryBtn.addEventListener("click", () => {
      showScene("nounsScene");
      syncLocationHash("nounsScene");
    });

    particlesCategoryBtn.addEventListener("click", () => {
      showScene("particlesScene");
      syncLocationHash("particlesScene");
    });

    verbsBackBtn.addEventListener("click", () => {
      showScene("menuScene");
      syncLocationHash("menuScene");
    });

    document.querySelectorAll('[data-suru-mode]').forEach(btn => {
      btn.addEventListener("click", () => changeSuruMode(btn.dataset.suruMode));
    });

    suruHintToggle?.addEventListener("click", () => {
      showHints = !showHints;
      localStorage.setItem(SURU_HINT_STORAGE_KEY, showHints);
      updateHintToggle();
      if (suruMode === "fill") {
        renderFillPrompt();
      }
    });

    suruSubmitBtn.addEventListener("click", checkSuruInput);
    suruSkipBtn.addEventListener("click", skipSuruQuestion);
    suruInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        checkSuruInput();
      }
    });

    nounsBackBtn.addEventListener("click", () => {
      showScene("menuScene");
      syncLocationHash("menuScene");
    });

    particlesBackBtn.addEventListener("click", () => {
      showScene("menuScene");
      syncLocationHash("menuScene");
    });

    // initialize board and state
    resetGameBoard();
    renderGuide();
    renderSuruGuide();
    updateHintToggle();
    applyInitialScene();
    window.addEventListener("hashchange", handleHashChange);
  </script>
</body>
</html>
